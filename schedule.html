<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jadwal â€” Academate</title>
<link rel="icon" type="image/png" href="/icon/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/icon/favicon.svg" />
<link rel="shortcut icon" href="/icon/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/icon/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="MyWebSite" />
<link rel="manifest" href="/icon/site.webmanifest" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css">

  <style>
    :root{
      --bg:#F7F7FA;--surface:#fff;--text:#1E1F24;--muted:#6C6F7F;--primary:#6F6CFF;--primary-2:#8B7CFF;--border:#ECECF1;--shadow:0 6px 24px rgba(30,31,36,.07);--radius:18px;--sidebar-w:280px;--content-max:1320px;--gap:18px;
      --danger:#EF4444; --hour-height: 60px;
    }
    html,body{height:auto}
    *{box-sizing:border-box}
    body{margin:0;font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;font-size:15px;padding-bottom:80px}
    a{color:inherit; text-decoration: none;}

    .app{padding:var(--gap);width:100%;max-width:1700px;margin:0 auto;min-height:100dvh}
    .main{background:var(--surface);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden; display: flex;}
    .main-content{padding:var(--gap);width:100%; display: flex; flex-direction: column;}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:var(--surface);cursor:pointer;font-weight:600;text-decoration:none;transition:.2s}
    .btn:hover{border-color:#d8d8e0}
    .btn-primary{background:var(--primary);color:#fff;border-color:transparent;box-shadow:0 6px 18px rgba(111,108,255,.28)}
    .btn-primary:hover{filter:brightness(.98)}
    .icon-btn{width:42px;height:42px;border-radius:50%;border:1px solid var(--border);background:var(--surface);display:grid;place-items:center;cursor:pointer;color:var(--muted);font-size:20px;transition:.2s;flex-shrink:0}
    .icon-btn:hover{color:var(--primary);border-color:#d8d8e0}
    
    .header{margin-top:var(--gap); margin-bottom:24px; flex-shrink: 0;}
    .header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .header-brand{font-size:20px;font-weight:700;background:linear-gradient(135deg,var(--primary),var(--primary-2));-webkit-background-clip:text;background-clip:text;color:transparent;display:inline-block}
    .header-actions{display:flex;gap:8px}
    .header-actions .icon-btn{width:38px;height:38px;font-size:18px}
    .header-main{display:flex;justify-content:space-between;align-items:center;gap:16px}
    .header-main h1{font-size:22px;margin:0}
    .header-main p{color:var(--muted);margin:4px 0 0;font-size:14px; min-height: 21px;} /* Added min-height */
    .header-avatar-link{text-decoration:none}
    .header-avatar{width:42px;height:42px;border-radius:50%;object-fit:cover;border:2px solid var(--border);flex-shrink:0}
    .header-toolbar{display:none}
    .header-avatar-link-desktop { display: none; }

    .mobile-nav{position:fixed;bottom:0;left:0;right:0;background:rgba(255,255,255,.8);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-top:1px solid var(--border);display:flex;justify-content:space-around;align-items:center;height:70px;padding:0 10px;z-index:1000}
    .mobile-nav a{display:flex;flex-direction:column;align-items:center;gap:4px;color:var(--muted);text-decoration:none;font-size:10px;font-weight:500;padding:8px;border-radius:8px}
    .mobile-nav a i{font-size:20px}
    .mobile-nav a.active{color:var(--primary)}

    .sidebar{display:none}
    
    .page-grid { flex-grow: 1; display: flex; flex-direction: column; min-height: 0; }
    
    .empty{ text-align:center; padding:60px; border:2px dashed var(--border); border-radius:14px; background:var(--surface); color:var(--muted) }

    .sk{position:relative;overflow:hidden;background:#F2F3F7;border-radius:8px}
    .sk::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.6),transparent);transform:translateX(-100%);animation:shimmer 1.4s infinite}
    @keyframes shimmer{100%{transform:translateX(100%)}}
    .skeleton-wrapper.hidden { display: none; }
    .desktop-skeleton-view { display: none; }
    .mobile-skeleton-view { display: block; }
    
    .time-column { flex-shrink: 0; width: 60px; }
    .time-label { height: var(--hour-height); text-align: right; padding-right: 12px; font-size: 12px; color: var(--muted); position: relative; }
    .time-label span { position: relative; top: -0.7em; }
    .day-column { border-left: 1px solid var(--border); position: relative; background-image: linear-gradient(to bottom, var(--border) 1px, transparent 1px); background-size: 100% var(--hour-height); }
    .day-column:first-child { border-left: none; }
    .all-day-task-area { padding: 4px; border-bottom: 1px solid var(--border); flex-shrink: 0; cursor: pointer; }
    .all-day-task { background: #F3F2FF; border-left: 3px solid var(--primary); border-radius: 6px; padding: 4px 8px; font-size: 12px; font-weight: 500; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .all-day-task-more { color: var(--primary); font-size: 12px; font-weight: 500; padding: 4px 8px; }
    
    .class-block { 
      position: absolute; left: 6px; right: 6px; border-radius: 10px; padding: 8px 10px; overflow: hidden; 
      transition: all 0.2s ease; cursor: pointer; border-left: 4px solid;
      display: flex; flex-direction: column; justify-content: flex-start;
    }
    .class-block.compact {
        padding-top: 6px;
        padding-bottom: 6px;
        justify-content: center;
    }
    .class-block:hover { transform: translateY(-2px); box-shadow: var(--shadow); z-index: 5; }
    .class-block h3 { font-size: 14px; font-weight: 600; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin:0 0 2px; }
    .class-block p { font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin:0; line-height: 1.4; }
    
    .current-time-indicator { position: absolute; left: 0; right: 0; height: 2px; background-color: var(--danger); z-index: 10; display: none; pointer-events: none; transition: all .2s; }
    .current-time-indicator::before { content: ''; position: absolute; left: -5px; top: -4px; width: 10px; height: 10px; border-radius: 50%; background-color: var(--danger); }

    @media (min-width:901px){
      body{padding-bottom:0}
      .mobile-nav, .mobile-schedule-header {display:none}
      .app{display:grid;grid-template-columns:var(--sidebar-w) minmax(0,1fr);gap:24px}

      .sidebar{display:flex;flex-direction:column;background:var(--surface);border-radius:var(--radius);box-shadow:var(--shadow);padding:24px}
      .brand{display:flex;align-items:center;gap:12px;font-weight:700;font-size:22px;margin-bottom:18px}
      .brand .logo{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,#8B7CFF,#6AC9FF)}
      .nav{display:flex;flex-direction:column;gap:8px;overflow:auto;padding-right:2px}
      .nav a{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:12px;color:var(--muted);text-decoration:none;font-weight:500;transition:.2s}
      .nav a i{font-size:20px}
      .nav a:hover{background:#F3F2FF;color:var(--primary)}
      .nav a.active{background:var(--primary);color:#fff;box-shadow:0 8px 20px rgba(111,108,255,.3)}
      .spacer{flex:1}
      .sidebar-footer{margin-top:auto;padding-top:16px;border-top:1px solid var(--border)}
      .sidebar-logout-btn{width:100%;display:flex;align-items:center;justify-content:center;gap:10px;padding:12px;border-radius:12px;background:transparent;border:1px solid var(--border);color:var(--muted);font-weight:600;cursor:pointer;transition:.2s}
      .sidebar-logout-btn:hover{background:#fde2e2;border-color:#f7b2b2;color:#c82424}
      
      .main-content{max-width:min(var(--content-max),calc(100vw - var(--sidebar-w) - 120px));margin:0 auto}

      .header{display:flex;justify-content:space-between;align-items:center;}
      .header-top,.header-main .header-avatar-link{display:none}
      .header-actions:not(.header-toolbar .header-actions){display: none;}
      .header-main{display:block}
      .header-main h1{font-size:26px}
      .header-main p{font-size:15px;margin-top:6px; min-height: 22.5px;} /* Added min-height */
      .header-toolbar{display:flex;align-items:center;gap:12px}
      .search-bar{position:relative}
      .search-bar input{width:220px;padding:12px 16px 12px 44px;border-radius:12px;border:1px solid var(--border);background:var(--bg);outline:none;transition:.2s}
      .search-bar input:focus{border-color:var(--primary);background:var(--surface)}
      .search-bar i{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:var(--muted)}
      
      .header-avatar-link-desktop { display: block; }
      
      .desktop-skeleton-view { display: block; }
      .mobile-skeleton-view { display: none; }
      
      .brand .logo {
  width: 34px;
  height: 34px;
  border-radius: 10px;
  background: linear-gradient(135deg, #8B7CFF, #6AC9FF);
  
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  padding: 6px;
}

.brand .logo svg {
  width: 100%;
  height: 100%;
}

      #desktop-date-nav { display: flex; align-items: center; gap: 8px; margin-left: auto;}
      .desktop-calendar { display: flex; flex-direction: column; flex-grow: 1; border: 1px solid var(--border); border-radius: 16px; overflow: hidden; }
      .desktop-calendar-header { display: grid; grid-template-columns: 60px repeat(7, 1fr); text-align: center; padding: 12px 0; border-bottom: 1px solid var(--border); background: var(--bg); }
      .day-header { padding: 0 4px; }
      .day-header .day-name { font-size: 13px; font-weight: 500; color: var(--muted); }
      .day-header .day-date { display: block; font-size: 18px; font-weight: 700; color: var(--text); margin-top: 6px; width: 36px; height: 36px; line-height: 36px; border-radius: 50%; margin-left: auto; margin-right: auto; transition: background-color .2s, color .2s; }
      .day-header.today .day-date { background: var(--primary); color: #fff; }
      .day-header.today .day-name { color: var(--primary); font-weight: 600; }
      
      .desktop-calendar-body { flex-grow: 1; overflow-y: auto; position: relative; display: flex; min-height: 500px; }
      .desktop-calendar-body::-webkit-scrollbar { width: 8px; }
      .desktop-calendar-body::-webkit-scrollbar-track { background: transparent; }
      .desktop-calendar-body::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
      .desktop-calendar-body::-webkit-scrollbar-thumb:hover { background: #d8d8e0; }
      .grid-container { 
        flex-grow: 1; 
        display: grid; 
        grid-template-columns: repeat(7, 1fr); 
        position: relative;
      }
      .day-column { padding-top: 40px; }
      .all-day-task-area { position: absolute; top: 0; left: 0; right: 0; }
    }
    
    @media (max-width: 900px) {
      .desktop-calendar { display: none; }

      .mobile-schedule-header { flex-shrink: 0; padding-bottom: 12px; border-bottom: 1px solid var(--border); margin-top: 16px; }
      .month-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
      .month-nav h2 { font-size: 18px; margin: 0; }
      .date-scroller { overflow-x: auto; padding-bottom: 8px; -ms-overflow-style: none; scrollbar-width: none; }
      .date-scroller::-webkit-scrollbar { display: none; }
      .date-puck-container { display: flex; gap: 10px; }
      .date-puck { flex: 0 0 48px; text-align: center; padding: 8px 0; border-radius: 12px; cursor: pointer; border: 2px solid transparent; }
      .date-puck:hover { background: var(--bg); }
      .date-puck .day { font-size: 12px; font-weight: 500; color: var(--muted); }
      .date-puck .date { font-size: 16px; font-weight: 700; }
      .date-puck.today { border-color: var(--primary-2); }
      .date-puck.selected { background: var(--primary); color: #fff; border-color: var(--primary); }
      .date-puck.selected .day { color: rgba(255,255,255,0.8); }

      .mobile-agenda-view { flex-grow: 1; overflow: hidden; display: flex; flex-direction: column; }
      .mobile-grid-container { flex-grow: 1; overflow-y: auto; display: flex; position: relative; }
      .mobile-grid-container .day-column { flex-grow: 1; }
      .class-block h3 { font-size: 13px; }
      .class-block p { font-size: 11px; }
    }
    @media (max-width: 480px) {
      .app, .main-content { padding: 12px; }
      .header-main h1 { font-size: 20px; }
      .header-main p { font-size: 13px; line-height: 1.4; min-height: 18.2px; }
    }

    .modal-overlay { position: fixed; inset: 0; background: rgba(30,31,36,0.5); backdrop-filter: blur(4px); z-index: 1100; display: none; align-items: center; justify-content: center; animation: fade-in 0.2s; }
    .modal-overlay.show { display: flex; }
    @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
    .modal-content { background: var(--surface); border-radius: var(--radius); width: min(90vw, 420px); box-shadow: var(--shadow); animation: pop-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @keyframes pop-in { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    .modal-header { display: flex; gap: 12px; align-items: center; padding: 16px; border-bottom: 1px solid var(--border); }
    .modal-icon { width: 44px; height: 44px; border-radius: 12px; display: grid; place-items: center; font-size: 24px; flex-shrink: 0; }
    .modal-title { font-size: 18px; font-weight: 600; margin: 0; }
    .modal-subtitle { font-size: 14px; color: var(--muted); margin: 4px 0 0; }
    .modal-body { padding: 16px; }
    .modal-detail-item { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
    .modal-detail-item i { color: var(--muted); font-size: 20px; width: 24px; text-align: center; }
    .modal-footer { padding: 12px 16px; background: var(--bg); border-top: 1px solid var(--border); display: flex; gap: 12px; justify-content: flex-end; }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar" aria-label="Navigasi utama">
<div class="brand">
  <div class="logo" aria-hidden="true">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
      <g>
        <path d="M4 4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h6c.494 0 .96-.12 1.37-.33A6.49 6.49 0 0 1 11 17.5a6.48 6.48 0 0 1 2-4.69V7a1 1 0 0 1 1-1h6v5.498a6.52 6.52 0 0 1 2 1.312V6a2 2 0 0 0-2-2h-6c-.768 0-1.47.289-2 .764A2.989 2.989 0 0 0 10 4H4Zm7 3v10a1 1 0 0 1-1 1H4V6h6a1 1 0 0 1 1 1Z"/>
        <path d="M16.007 17c.04-1.415.248-2.669.553-3.585c.171-.513.364-.893.554-1.134c.195-.247.329-.281.386-.281c.057 0 .192.034.386.281c.19.241.383.62.554 1.134c.305.916.513 2.17.553 3.585h-2.986Zm-.396-3.9c.108-.323.23-.622.368-.887A5.504 5.504 0 0 0 12.023 17h2.984c.04-1.5.26-2.866.604-3.9Zm3.778 0a6.133 6.133 0 0 0-.368-.887A5.504 5.504 0 0 1 22.978 17h-2.985c-.04-1.5-.26-2.866-.604-3.9Zm.604 4.9h2.985a5.504 5.504 0 0 1-3.957 4.787c.138-.265.26-.564.368-.886c.345-1.035.564-2.4.604-3.901Zm-2.107 4.719c-.194.247-.329.281-.386-.281c-.057 0-.191-.034-.386-.281c-.19-.241-.383-.62-.554-1.135c-.305-.915-.513-2.17-.553-3.584h2.986c-.04 1.415-.248 2.669-.553 3.584c-.171.514-.364.894-.554 1.135ZM12.023 18a5.504 5.504 0 0 0 3.956 4.787a6.133 6.133 0 0 1-.367-.886c-.346-1.035-.565-2.4-.605-3.901h-2.984Z"/>
      </g>
    </svg>
  </div>
  Academate
</div>      <nav class="nav">
        <a href="/dashboard"><i class="ri-dashboard-2-line"></i><span>Dasbor</span></a>
        <a href="/classes"><i class="ri-book-open-line"></i><span>Kelas</span></a>
        <a href="/task"><i class="ri-task-line"></i><span>Tugas</span></a>
        <a class="active" href="/schedule"><i class="ri-calendar-2-line"></i><span>Jadwal</span></a>
        <a href="/notes"><i class="ri-file-list-3-line"></i><span>Catatan</span></a>
        <a href="/account"><i class="ri-user-3-line"></i><span>Akun</span></a>
      </nav>
      <div class="spacer"></div>
      <div class="sidebar-footer"><button id="logout-button-desktop" class="sidebar-logout-btn" type="button" title="Keluar"><i class="ri-logout-box-r-line"></i><span>Keluar</span></button></div>
    </aside>

    <main class="main">
      <div class="main-content">
        
        <header class="header skeleton-wrapper">
            <div class="header-top">
                <div class="sk" style="width: 120px; height: 28px;"></div>
                <div class="header-actions">
                    <div class="icon-btn sk" style="border-radius: 50%;"></div>
                    <div class="icon-btn sk" style="border-radius: 50%;"></div>
                </div>
            </div>
            <div class="header-main">
                <div>
                    <div class="sk" style="width: 180px; height: 28px; border-radius: 8px;"></div>
                    <div class="sk" style="width: 240px; height: 21px; margin-top: 8px; border-radius: 8px;"></div>
                </div>
            </div>
            <div class="header-toolbar">
                <div class="sk" style="width: 220px; height: 46px; border-radius: 12px;"></div>
                <div style="display: flex; gap: 8px; margin-left: auto;">
                    <div class="sk" style="width: 80px; height: 42px; border-radius: 12px;"></div>
                    <div class="sk icon-btn" style="border-radius: 50%;"></div>
                    <div class="sk icon-btn" style="border-radius: 50%;"></div>
                </div>
                <div class="sk icon-btn" style="border-radius: 50%;"></div>
                <div class="sk header-avatar" style="border-radius: 50%;"></div>
            </div>
        </header>

        <div id="actual-header" style="display: none;">
            <header class="header">
              <div class="header-top">
                <div class="header-brand">Academate</div>
                <div class="header-actions">
                  <button class="icon-btn" title="Cari"><i class="ri-search-line"></i></button>
                  <a href="/notification" class="icon-btn" title="Notifikasi"><i class="ri-notification-3-line"></i></a>
                </div>
              </div>
              <div class="header-main">
                <div>
                  <h1>Jadwal</h1>
                  <p>&nbsp;</p>
                </div>
                <a href="/account" class="header-avatar-link"><img id="header-avatar-img" class="header-avatar" alt="Foto profil"></a>
              </div>
              <div class="header-toolbar">
                <div class="search-bar">
                  <i class="ri-search-line"></i>
                  <input type="text" placeholder="Cari jadwal...">
                </div>
                <div id="desktop-date-nav">
                    <button class="btn" id="today-btn">Hari Ini</button>
                    <button class="icon-btn" id="prev-week-btn" title="Minggu sebelumnya"><i class="ri-arrow-left-s-line"></i></button>
                    <button class="icon-btn" id="next-week-btn" title="Minggu berikutnya"><i class="ri-arrow-right-s-line"></i></button>
                </div>
                <a href="/notification" class="icon-btn" title="Notifikasi"><i class="ri-notification-3-line"></i></a>
                <a href="/account" class="header-avatar-link-desktop"><img id="header-avatar-img-desktop" class="header-avatar" alt="Foto profil"></a>
              </div>
            </header>
        </div>


        <div class="page-grid skeleton-wrapper">
            <div class="mobile-skeleton-view">
                <div class="mobile-schedule-header" style="border-bottom: none;">
                    <div class="month-nav">
                        <div class="icon-btn sk" style="border-radius: 50%;"></div>
                        <div class="sk" style="height: 27px; width: 150px;"></div>
                        <div class="icon-btn sk" style="border-radius: 50%;"></div>
                    </div>
                    <div class="date-scroller">
                        <div class="date-puck-container">
                            <div class="sk" style="flex: 0 0 48px; height: 60px; border-radius: 12px;"></div>
                            <div class="sk" style="flex: 0 0 48px; height: 60px; border-radius: 12px;"></div>
                            <div class="sk" style="flex: 0 0 48px; height: 60px; border-radius: 12px; background: #e0e0e0;"></div>
                            <div class="sk" style="flex: 0 0 48px; height: 60px; border-radius: 12px;"></div>
                            <div class="sk" style="flex: 0 0 48px; height: 60px; border-radius: 12px;"></div>
                            <div class="sk" style="flex: 0 0 48px; height: 60px; border-radius: 12px;"></div>
                        </div>
                    </div>
                </div>
                <div class="mobile-agenda-view">
                    <div class="mobile-grid-container" style="border-top: 1px solid var(--border); padding-top: 12px;">
                        <div class="time-column">
                            <div style="height: 60px; display: flex; justify-content: flex-end; padding-right: 12px;"><div class="sk" style="width: 40px; height: 14px; margin-top: -7px;"></div></div>
                            <div style="height: 60px; display: flex; justify-content: flex-end; padding-right: 12px;"><div class="sk" style="width: 40px; height: 14px; margin-top: -7px;"></div></div>
                            <div style="height: 60px; display: flex; justify-content: flex-end; padding-right: 12px;"><div class="sk" style="width: 40px; height: 14px; margin-top: -7px;"></div></div>
                            <div style="height: 60px; display: flex; justify-content: flex-end; padding-right: 12px;"><div class="sk" style="width: 40px; height: 14px; margin-top: -7px;"></div></div>
                            <div style="height: 60px; display: flex; justify-content: flex-end; padding-right: 12px;"><div class="sk" style="width: 40px; height: 14px; margin-top: -7px;"></div></div>
                            <div style="height: 60px; display: flex; justify-content: flex-end; padding-right: 12px;"><div class="sk" style="width: 40px; height: 14px; margin-top: -7px;"></div></div>
                            <div style="height: 60px; display: flex; justify-content: flex-end; padding-right: 12px;"><div class="sk" style="width: 40px; height: 14px; margin-top: -7px;"></div></div>
                            <div style="height: 60px; display: flex; justify-content: flex-end; padding-right: 12px;"><div class="sk" style="width: 40px; height: 14px; margin-top: -7px;"></div></div>
                        </div>
                        <div class="day-column" style="background: none;">
                            <div class="sk" style="position: absolute; left: 6px; right: 6px; top: 30px; height: 80px; border-radius: 10px;"></div>
                            <div class="sk" style="position: absolute; left: 6px; right: 6px; top: 150px; height: 120px; border-radius: 10px;"></div>
                            <div class="sk" style="position: absolute; left: 6px; right: 6px; top: 300px; height: 100px; border-radius: 10px;"></div>
                            <div class="sk" style="position: absolute; left: 6px; right: 6px; top: 420px; height: 70px; border-radius: 10px;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="desktop-skeleton-view">
                <div class="desktop-calendar" style="border-color: transparent; box-shadow: none;">
                    <div class="desktop-calendar-header">
                        <div></div>
                        <div class="day-header"><div class="sk" style="width: 36px; height: 18px; margin: 0 auto 6px;"></div><div class="sk" style="width: 36px; height: 36px; border-radius: 50%; margin: 0 auto;"></div></div>
                        <div class="day-header"><div class="sk" style="width: 36px; height: 18px; margin: 0 auto 6px;"></div><div class="sk" style="width: 36px; height: 36px; border-radius: 50%; margin: 0 auto;"></div></div>
                        <div class="day-header"><div class="sk" style="width: 36px; height: 18px; margin: 0 auto 6px;"></div><div class="sk" style="width: 36px; height: 36px; border-radius: 50%; margin: 0 auto; background: #e0e0e0;"></div></div>
                        <div class="day-header"><div class="sk" style="width: 36px; height: 18px; margin: 0 auto 6px;"></div><div class="sk" style="width: 36px; height: 36px; border-radius: 50%; margin: 0 auto;"></div></div>
                        <div class="day-header"><div class="sk" style="width: 36px; height: 18px; margin: 0 auto 6px;"></div><div class="sk" style="width: 36px; height: 36px; border-radius: 50%; margin: 0 auto;"></div></div>
                        <div class="day-header"><div class="sk" style="width: 36px; height: 18px; margin: 0 auto 6px;"></div><div class="sk" style="width: 36px; height: 36px; border-radius: 50%; margin: 0 auto;"></div></div>
                        <div class="day-header"><div class="sk" style="width: 36px; height: 18px; margin: 0 auto 6px;"></div><div class="sk" style="width: 36px; height: 36px; border-radius: 50%; margin: 0 auto;"></div></div>
                    </div>
                    <div class="desktop-calendar-body" style="border-top: 1px solid var(--border);">
                         <div class="time-column">
                            <div style="height: 60px; display: flex; justify-content: flex-end; padding-right: 12px;"><div class="sk" style="width: 40px; height: 14px; margin-top: -7px;"></div></div>
                            <div style="height: 60px; display: flex; justify-content: flex-end; padding-right: 12px;"><div class="sk" style="width: 40px; height: 14px; margin-top: -7px;"></div></div>
                            <div style="height: 60px; display: flex; justify-content: flex-end; padding-right: 12px;"><div class="sk" style="width: 40px; height: 14px; margin-top: -7px;"></div></div>
                            <div style="height: 60px; display: flex; justify-content: flex-end; padding-right: 12px;"><div class="sk" style="width: 40px; height: 14px; margin-top: -7px;"></div></div>
                            <div style="height: 60px; display: flex; justify-content: flex-end; padding-right: 12px;"><div class="sk" style="width: 40px; height: 14px; margin-top: -7px;"></div></div>
                            <div style="height: 60px; display: flex; justify-content: flex-end; padding-right: 12px;"><div class="sk" style="width: 40px; height: 14px; margin-top: -7px;"></div></div>
                         </div>
                         <div class="grid-container" style="border-left: 1px solid var(--border);">
                            <div class="sk" style="position: absolute; top: 4px; left: calc(100%/7 * 2 + 6px); right: calc(100%/7 * 4 + 6px); height: 26px;"></div>
                            <div class="sk" style="position: absolute; top: 70px; left: calc(100%/7 * 1 + 6px); right: calc(100%/7 * 5 + 6px); height: 90px;"></div>
                            <div class="sk" style="position: absolute; top: 200px; left: calc(100%/7 * 4 + 6px); right: calc(100%/7 * 2 + 6px); height: 140px;"></div>
                         </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="page-grid" id="actual-content-grid" style="display: none;">
            <div id="calendar-container" aria-live="polite" style="flex-grow: 1; display: flex; flex-direction: column; overflow: hidden;">
            </div>
        </div>
      </div>
    </main>
  </div>

  <nav class="mobile-nav">
    <a href="/dashboard"><i class="ri-dashboard-2-line"></i><span>Dasbor</span></a>
    <a href="/classes"><i class="ri-book-open-line"></i><span>Kelas</span></a>
    <a href="/task"><i class="ri-task-line"></i><span>Tugas</span></a>
    <a class="active" href="/schedule"><i class="ri-calendar-2-line"></i><span>Jadwal</span></a>
    <a href="/notes"><i class="ri-file-list-3-line"></i><span>Catatan</span></a>
  </nav>

  <div class="modal-overlay" id="quick-look-modal">
    <div class="modal-content" id="quick-look-modal-content">
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, getDocs, query } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { initializeAppCheck, ReCaptchaV3Provider } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js";

    const firebaseConfig = { apiKey: "AIzaSyCGr2zchpiAiTn-bMFk-eLNE-1OgGzaSdA", authDomain: "acadmte.firebaseapp.com", projectId: "acadmte", storageBucket: "acadmte.appspot.com", messagingSenderId: "547286858993", appId: "1:547286858993:web:b83de49e7eb1cc35a67d50" };

    const app = initializeApp(firebaseConfig);
    const appCheck = initializeAppCheck(app, {
  provider: new ReCaptchaV3Provider('6LeCCuQrAAAAAETuv-d3fMG5dtZ4pC_Mz9vPlabc'),
  isTokenAutoRefreshEnabled: true
});
    const auth = getAuth(app);
    const db = getFirestore(app);

    let timeIndicatorInterval = null;
    let currentUser = null;
    let selectedDate = new Date();
    let allData = { classes: [], tasks: [] };
    const classColors = [
        { bg: '#F3F2FF', border: '#8B5CF6' }, { bg: '#ECFDF5', border: '#10B981' },
        { bg: '#FFFBEB', border: '#F59E0B' }, { bg: '#FEF2F2', border: '#EF4444' },
        { bg: '#EFF6FF', border: '#3B82F6' }, { bg: '#FDF2F8', border: '#EC4899' }
    ];
    const hourHeight = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--hour-height'));

    function showContent() {
        const skeletons = document.querySelectorAll('.skeleton-wrapper');
        skeletons.forEach(sk => sk.style.display = 'none');
        
        const actualHeader = document.getElementById('actual-header');
        if(actualHeader) actualHeader.style.display = 'block';

        const contentGrid = document.getElementById('actual-content-grid');
        if (contentGrid) contentGrid.style.display = 'flex';
    }

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        if (timeIndicatorInterval) clearInterval(timeIndicatorInterval);
        window.location.replace('/auth');
        return;
      }
      currentUser = user;
      hydrateAvatar();
      await loadScheduleData(user);
      render();
      showContent();
    });

    document.getElementById('logout-button-desktop')?.addEventListener('click', () => signOut(auth));
    document.getElementById('today-btn')?.addEventListener('click', () => { selectedDate = new Date(); render(); });
    document.getElementById('prev-week-btn')?.addEventListener('click', () => { selectedDate.setDate(selectedDate.getDate() - 7); render(); });
    document.getElementById('next-week-btn')?.addEventListener('click', () => { selectedDate.setDate(selectedDate.getDate() + 7); render(); });

    function hydrateAvatar() {
      const mobileAvatar = document.getElementById('header-avatar-img');
      const desktopAvatar = document.getElementById('header-avatar-img-desktop');
      const name = localStorage.getItem('userDisplayName') || (currentUser?.displayName ?? 'A');
      const photo = localStorage.getItem('userPhotoURL') || currentUser?.photoURL;
      const src = photo || `https://placehold.co/80x80/E5E7EB/6B7280?text=${(name||'A').charAt(0)}`;
      if (mobileAvatar) mobileAvatar.src = src;
      if (desktopAvatar) desktopAvatar.src = src;
    }

    async function loadScheduleData(user) {
        const userDocRef = doc(db, 'users', user.uid);
        const userDocSnap = await getDoc(userDocRef);
        const joinedClassesIds = userDocSnap.exists() ? userDocSnap.data().joinedClasses || [] : [];
        
        if (joinedClassesIds.length === 0) {
          allData = { classes: [], tasks: [] };
          return;
        }
        
        const classPromises = joinedClassesIds.map(id => getDoc(doc(db, 'classes', id)));
        const classSnapshots = await Promise.all(classPromises);
        allData.classes = classSnapshots.map(snap => ({ id: snap.id, ...snap.data() })).filter(c => c.namaMataKuliah);

        const taskPromises = joinedClassesIds.map(id => getDocs(query(collection(db, 'classes', id, 'tasks'))));
        const taskSnapshots = await Promise.all(taskPromises);
        allData.tasks = [];
        taskSnapshots.forEach(snap => {
            snap.forEach(d => allData.tasks.push({ id: d.id, ...d.data() }));
        });
    }

    function render() {
        const container = document.getElementById('calendar-container');
        if (!container) return;
        
        if (!currentUser || (allData.classes.length === 0 && allData.tasks.length === 0)) {
            container.innerHTML = `<div class="empty"><h3>Jadwal Anda kosong</h3><p>Bergabunglah dengan kelas untuk melihat jadwal.</p></div>`;
            return;
        }
        
        let minHour = 7;
        let maxHour = 20;

        if (allData.classes.length > 0) {
            let tempMin = 24, tempMax = 0;
            allData.classes.forEach(c => {
                if (!c.waktu || !c.waktu.includes(':')) return;
                const [startH] = c.waktu.split(':').map(Number);
                tempMin = Math.min(tempMin, startH);
                let endH, endM;
                if (c.waktuSelesai && c.waktuSelesai.includes(':')) {
                    [endH, endM] = c.waktuSelesai.split(':').map(Number);
                } else {
                    const [sH, sM] = c.waktu.split(':').map(Number);
                    const endTotalMinutes = (sH * 60 + sM) + (c.sks || 2) * 50;
                    endH = Math.floor(endTotalMinutes / 60);
                    endM = endTotalMinutes % 60;
                }
                const effectiveEndHour = endM > 0 ? endH + 1 : endH;
                tempMax = Math.max(tempMax, effectiveEndHour);
            });
            
            if (tempMin <= tempMax) {
                minHour = Math.floor(tempMin) - 1;
                maxHour = Math.ceil(tempMax) + 1;
            }
        }
        
        const calendarStartHour = Math.max(0, Math.min(minHour, 7));
        const calendarEndHour = Math.min(24, Math.max(maxHour, 20));

        if (window.innerWidth <= 900) {
            renderMobileAgenda(container, calendarStartHour, calendarEndHour);
        } else {
            renderDesktopCalendar(container, calendarStartHour, calendarEndHour);
        }
    }

    function getStartOfWeek(date) {
        const d = new Date(date);
        const day = d.getDay();
        const diff = d.getDate() - day + (day === 0 ? -6 : 1);
        d.setHours(0, 0, 0, 0);
        return new Date(d.setDate(diff));
    }

    function renderDesktopCalendar(container, calendarStartHour, calendarEndHour) {
        const startOfWeek = getStartOfWeek(selectedDate);
        const weekDates = Array.from({ length: 7 }).map((_, i) => {
            const date = new Date(startOfWeek);
            date.setDate(date.getDate() + i);
            return date;
        });

        const endOfWeek = weekDates[6];
        const dateRangeString = startOfWeek.getMonth() === endOfWeek.getMonth()
            ? `${startOfWeek.toLocaleDateString('id-ID', {day: 'numeric'})} - ${endOfWeek.toLocaleDateString('id-ID', {day: 'numeric', month: 'long', year: 'numeric'})}`
            : `${startOfWeek.toLocaleDateString('id-ID', {day: 'numeric', month: 'long'})} - ${endOfWeek.toLocaleDateString('id-ID', {day: 'numeric', month: 'long', year: 'numeric'})}`;
        
        const titleEl = document.querySelector('#actual-header .header-main h1');
        const subtitleEl = document.querySelector('#actual-header .header-main p');
        if(titleEl) titleEl.textContent = 'Jadwal Mingguan';
        if(subtitleEl) subtitleEl.textContent = dateRangeString;

        container.innerHTML = `<div class="desktop-calendar"><div class="desktop-calendar-header"></div><div class="desktop-calendar-body"></div></div>`;
        const header = container.querySelector('.desktop-calendar-header');
        const body = container.querySelector('.desktop-calendar-body');

        header.innerHTML = `<div></div>`; 
        weekDates.forEach(date => {
            const dayHeader = document.createElement('div');
            dayHeader.className = 'day-header';
            if (isSameDay(date, new Date())) dayHeader.classList.add('today');
            dayHeader.innerHTML = `<span class="day-name">${date.toLocaleString('id-ID', { weekday: 'short' })}</span><span class="day-date">${date.getDate()}</span>`;
            header.appendChild(dayHeader);
        });

        const timeColumn = document.createElement('div');
        timeColumn.className = 'time-column';
        for (let hour = calendarStartHour; hour <= calendarEndHour; hour++) {
            timeColumn.innerHTML += `<div class="time-label"><span>${hour.toString().padStart(2, '0')}:00</span></div>`;
        }

        const gridContainer = document.createElement('div');
        gridContainer.className = 'grid-container';
        gridContainer.style.minHeight = `${(calendarEndHour - calendarStartHour + 1) * hourHeight}px`;
        gridContainer.insertAdjacentHTML('beforeend', '<div class="current-time-indicator"></div>');

        const dayFullNames = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];

        weekDates.forEach((date, index) => {
            const dayColumn = document.createElement('div');
            dayColumn.className = 'day-column';
            const dayName = dayFullNames[date.getDay()];
            dayColumn.dataset.dayName = dayName;
            
            const tasksForDay = allData.tasks.filter(t => isSameDay(safeGetDate(t.dueDate), date));
            if(tasksForDay.length > 0) {
                const taskArea = document.createElement('div');
                taskArea.className = 'all-day-task-area';
                taskArea.onclick = () => showQuickLookModal({ tasksForDay: tasksForDay, date: date });

                const maxTasksToShow = 2;
                tasksForDay.slice(0, maxTasksToShow).forEach(task => {
                    const taskEl = document.createElement('div');
                    taskEl.className = 'all-day-task';
                    taskEl.textContent = escapeHTML(task.title);
                    taskArea.appendChild(taskEl);
                });

                if (tasksForDay.length > maxTasksToShow) {
                    const moreEl = document.createElement('div');
                    moreEl.className = 'all-day-task-more';
                    moreEl.textContent = `+${tasksForDay.length - maxTasksToShow} lagi`;
                    taskArea.appendChild(moreEl);
                }
                dayColumn.appendChild(taskArea);
            }
            gridContainer.appendChild(dayColumn);
        });
        
        body.append(timeColumn, gridContainer);

        allData.classes.forEach((c, classIdx) => {
            const dayCol = gridContainer.querySelector(`[data-day-name="${c.hari}"]`);
            if (!dayCol || !c.waktu) return;

            const [startHour, startMinute] = c.waktu.split(':').map(Number);
            let durationMinutes = (c.sks || 2) * 50;
            if (c.waktuSelesai) {
                const [endHour, endMinute] = c.waktuSelesai.split(':').map(Number);
                durationMinutes = (endHour * 60 + endMinute) - (startHour * 60 + startMinute);
            }
            
            const startOffsetMinutes = (startHour - calendarStartHour) * 60 + startMinute;
            const top = (startOffsetMinutes / 60) * hourHeight;
            const height = (durationMinutes / 60) * hourHeight;
            
            const classBlock = document.createElement('div');
            classBlock.className = 'class-block';
            classBlock.style.top = `${top}px`;
            classBlock.style.height = `${height}px`;

            const color = classColors[classIdx % classColors.length];
            classBlock.style.backgroundColor = color.bg;
            classBlock.style.borderColor = color.border;
            classBlock.onclick = () => showQuickLookModal({classData: c});
            
            const timeString = `${c.waktu} - ${c.waktuSelesai || ''}`;
            const roomString = escapeHTML(c.ruang);
            let contentHTML = `<h3>${escapeHTML(c.namaMataKuliah)}</h3>`;

            if (height < 50) { 
                classBlock.classList.add('compact');
                contentHTML += `<p style="color: ${color.border};">${c.waktu}</p>`;
            } else if (height < 75) {
                classBlock.classList.add('compact');
                contentHTML += `<p style="color: ${color.border};">${timeString} â€¢ ${roomString}</p>`;
            } else {
                contentHTML += `<p style="color: ${color.border};">${timeString}</p><p>${roomString}</p>`;
            }
            classBlock.innerHTML = contentHTML;

            dayCol.appendChild(classBlock);
        });
        setupCurrentTimeIndicator(gridContainer, 'desktop', calendarStartHour, calendarEndHour, weekDates);
    }

    function renderMobileAgenda(container, calendarStartHour, calendarEndHour) {
        container.innerHTML = `<div class="mobile-schedule-header"></div><div class="mobile-agenda-view"></div>`;
        const header = container.querySelector('.mobile-schedule-header');
        const agendaView = container.querySelector('.mobile-agenda-view');
        
        const titleEl = document.querySelector('#actual-header .header-main h1');
        const subtitleEl = document.querySelector('#actual-header .header-main p');
        if(titleEl) titleEl.textContent = 'Jadwal Harian';
        if(subtitleEl) subtitleEl.textContent = selectedDate.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });

        header.innerHTML = `<div class="month-nav">
            <button class="icon-btn" id="prev-month-btn"><i class="ri-arrow-left-s-line"></i></button>
            <h2>${selectedDate.toLocaleString('id-ID', { month: 'long', year: 'numeric' })}</h2>
            <button class="icon-btn" id="next-month-btn"><i class="ri-arrow-right-s-line"></i></button>
        </div><div class="date-scroller"><div class="date-puck-container"></div></div>`;

        const dateContainer = header.querySelector('.date-puck-container');
        const daysInMonth = new Date(selectedDate.getFullYear(), selectedDate.getMonth() + 1, 0).getDate();
        
        for (let i = 1; i <= daysInMonth; i++) {
            const date = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), i);
            const puck = document.createElement('div');
            puck.className = 'date-puck';
            if (isSameDay(date, new Date())) puck.classList.add('today');
            if (isSameDay(date, selectedDate)) puck.classList.add('selected');
            puck.innerHTML = `<div class="day">${date.toLocaleString('id-ID', { weekday: 'short' })}</div><div class="date">${i}</div>`;
            puck.onclick = () => { selectedDate = date; render(); };
            dateContainer.appendChild(puck);
        }
        
        const tasksForDay = allData.tasks.filter(t => isSameDay(safeGetDate(t.dueDate), selectedDate));
        const dayOfWeek = selectedDate.toLocaleString('id-ID', { weekday: 'long' });
        const classesForDay = allData.classes.filter(c => c.hari === dayOfWeek).sort((a,b) => (a.waktu || '00:00').localeCompare(b.waktu || '00:00'));

        if (tasksForDay.length > 0) {
            const taskArea = document.createElement('div');
            taskArea.className = 'all-day-task-area';
            taskArea.onclick = () => showQuickLookModal({ tasksForDay: tasksForDay, date: selectedDate });
            
            const maxTasksToShow = 2;
            tasksForDay.slice(0, maxTasksToShow).forEach(task => {
                const taskEl = document.createElement('div');
                taskEl.className = 'all-day-task';
                taskEl.textContent = escapeHTML(task.title);
                taskArea.appendChild(taskEl);
            });

            if (tasksForDay.length > maxTasksToShow) {
                const moreEl = document.createElement('div');
                moreEl.className = 'all-day-task-more';
                moreEl.textContent = `+${tasksForDay.length - maxTasksToShow} lagi`;
                taskArea.appendChild(moreEl);
            }
            agendaView.appendChild(taskArea);
        }
        
        const gridContainer = document.createElement('div');
        gridContainer.className = 'mobile-grid-container';
        agendaView.appendChild(gridContainer);
        
        const timeColumn = document.createElement('div');
        timeColumn.className = 'time-column';
        for (let hour = calendarStartHour; hour <= calendarEndHour; hour++) {
            timeColumn.innerHTML += `<div class="time-label"><span>${hour.toString().padStart(2, '0')}:00</span></div>`;
        }
        
        const dayColumn = document.createElement('div');
        dayColumn.className = 'day-column';
        dayColumn.style.minHeight = `${(calendarEndHour - calendarStartHour + 1) * hourHeight}px`;
        dayColumn.insertAdjacentHTML('beforeend', '<div class="current-time-indicator"></div>');
        gridContainer.append(timeColumn, dayColumn);

        if (classesForDay.length === 0 && tasksForDay.length === 0) {
            agendaView.innerHTML = `<div class="empty" style="padding: 30px 0;"><h3>Tidak ada jadwal</h3><p>Nikmati hari luangmu!</p></div>`;
        } else {
             classesForDay.forEach((c) => {
                const color = classColors[allData.classes.indexOf(c) % classColors.length];
                const [startHour, startMinute] = c.waktu.split(':').map(Number);
                const startOffsetMinutes = (startHour - calendarStartHour) * 60 + startMinute;
                const top = (startOffsetMinutes / 60) * hourHeight;

                let durationMinutes = (c.sks || 2) * 50;
                if (c.waktuSelesai) {
                    const [endHour, endMinute] = c.waktuSelesai.split(':').map(Number);
                    durationMinutes = (endHour * 60 + endMinute) - (startHour * 60 + startMinute);
                }
                const height = (durationMinutes / 60) * hourHeight;
                
                const classBlock = document.createElement('div');
                classBlock.className = 'class-block';
                classBlock.style.top = `${top}px`;
                classBlock.style.height = `${height}px`;
                classBlock.style.backgroundColor = color.bg;
                classBlock.style.borderColor = color.border;
                classBlock.onclick = () => showQuickLookModal({classData: c});

                let contentHTML = `<h3>${escapeHTML(c.namaMataKuliah)}</h3>`;
                const dosenString = escapeHTML(c.dosen);
                const roomString = `Ruang ${escapeHTML(c.ruang)}`;

                if (height < 50) { 
                    classBlock.classList.add('compact');
                } else if (height < 75) {
                    classBlock.classList.add('compact');
                    contentHTML += `<p>${dosenString}</p>`;
                } else {
                    contentHTML += `<p>${dosenString}</p><p>${roomString}</p>`;
                }
                classBlock.innerHTML = contentHTML;

                dayColumn.appendChild(classBlock);
            });
        }

        document.getElementById('prev-month-btn').onclick = () => { selectedDate.setMonth(selectedDate.getMonth() - 1); render(); };
        document.getElementById('next-month-btn').onclick = () => { selectedDate.setMonth(selectedDate.getMonth() + 1); render(); };
        
        const selectedPuck = dateContainer.querySelector('.selected');
        if (selectedPuck) {
            const scroller = dateContainer.parentElement;
            scroller.scrollLeft = selectedPuck.offsetLeft - (scroller.clientWidth / 2) + (selectedPuck.clientWidth / 2);
        }

        setupCurrentTimeIndicator(dayColumn, 'mobile', calendarStartHour, calendarEndHour);
    }

    function setupCurrentTimeIndicator(container, mode, calendarStartHour, calendarEndHour, weekDates = []) {
      if (timeIndicatorInterval) clearInterval(timeIndicatorInterval);
      
      const updatePosition = () => {
        const now = new Date();
        const indicator = container.querySelector('.current-time-indicator');
        if (!indicator) return;

        const totalMinutesSinceStart = (now.getHours() - calendarStartHour) * 60 + now.getMinutes();
        const totalCalendarMinutes = (calendarEndHour - calendarStartHour + 1) * 60;

        if (totalMinutesSinceStart < 0 || totalMinutesSinceStart > totalCalendarMinutes) {
            indicator.style.display = 'none';
            return;
        }

        if (mode === 'desktop') {
            const dayColumns = Array.from(container.querySelectorAll('.day-column'));
            const todayCol = dayColumns.find(col => col.dataset.dayName === now.toLocaleString('id-ID', {weekday:'long'}));
            
            if (!todayCol || weekDates.findIndex(d => isSameDay(d, now)) === -1) {
                indicator.style.display = 'none';
                return;
            }
            indicator.style.display = 'block';
            indicator.style.top = `${(totalMinutesSinceStart / 60) * hourHeight}px`;
            indicator.style.left = `${todayCol.offsetLeft}px`;
            indicator.style.width = `${todayCol.offsetWidth}px`;
        } else { // Mobile
            if (!isSameDay(now, selectedDate)) { 
                indicator.style.display = 'none'; 
                return;
            }
            indicator.style.display = 'block';
            indicator.style.top = `${(totalMinutesSinceStart / 60) * hourHeight}px`;
        }
      };
      updatePosition();
      timeIndicatorInterval = setInterval(updatePosition, 60000);
    }

    function showQuickLookModal(data) {
        const modal = document.getElementById('quick-look-modal');
        const content = document.getElementById('quick-look-modal-content');
        
        let html = '';
        if (data.classData) {
            const c = data.classData;
            const color = classColors[allData.classes.indexOf(c) % classColors.length] || classColors[0];
            html = `<div class="modal-header">
                        <div class="modal-icon" style="background:${color.bg}; color: ${color.border};">${c.classIcon || 'ðŸ“š'}</div>
                        <div><h3 class="modal-title">${escapeHTML(c.namaMataKuliah)}</h3><p class="modal-subtitle">${escapeHTML(c.dosen)}</p></div>
                    </div>
                    <div class="modal-body">
                        <div class="modal-detail-item"><i class="ri-time-line"></i><span>${c.hari}, ${c.waktu} - ${c.waktuSelesai || ''}</span></div>
                        <div class="modal-detail-item"><i class="ri-map-pin-line"></i><span>Ruang ${escapeHTML(c.ruang)}</span></div>
                        <div class="modal-detail-item"><i class="ri-book-3-line"></i><span>${c.sks} SKS</span></div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" id="modal-close-btn">Tutup</button>
                        <a href="/class_page?id=${c.id}" class="btn btn-primary">Buka Kelas</a>
                    </div>`;
        } else if (data.task) {
        } else if (data.tasksForDay) {
            const dateString = data.date.toLocaleDateString('id-ID', {weekday:'long', day:'numeric', month:'long'});
            html = `<div class="modal-header">
                        <div class="modal-icon" style="background:#F3F2FF"><i class="ri-task-line" style="color: var(--primary)"></i></div>
                        <div><h3 class="modal-title">Tugas Tenggat</h3><p class="modal-subtitle">${dateString}</p></div>
                    </div>
                    <div class="modal-body" style="padding-top: 8px; padding-bottom: 8px; max-height: 40vh; overflow-y: auto;">
                        ${data.tasksForDay.map(t => `
                            <div class="modal-detail-item" style="margin-bottom: 8px; padding: 10px; background: var(--bg); border-radius: 8px; align-items: flex-start;">
                                <i class="ri-checkbox-blank-circle-line" style="margin-top: 3px;"></i>
                                <span style="white-space: normal;">${escapeHTML(t.title)}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="modal-footer">
                        <button class="btn" id="modal-close-btn">Tutup</button>
                    </div>`;
        }
        
        content.innerHTML = html;
        modal.classList.add('show');
        
        document.getElementById('modal-close-btn').onclick = () => modal.classList.remove('show');
        modal.onclick = (e) => { if (e.target === modal) modal.classList.remove('show'); };
    }
    
    function safeGetDate(ts) {
        if (!ts) return null;
        if (typeof ts.toDate === 'function') return ts.toDate();
        if (ts instanceof Date) return ts;
        return null;
    }

    function isSameDay(d1, d2) {
        if (!d1 || !d2) return false;
        return d1.getFullYear() === d2.getFullYear() && d1.getMonth() === d2.getMonth() && d1.getDate() === d2.getDate();
    }
    function escapeHTML(s) { return (s || '').replace(/[&<>"']/g, m => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;" }[m])); }

    window.addEventListener('resize', render);
  </script>
</body>
</html>
