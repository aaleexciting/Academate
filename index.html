<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Academate — Ngampus Bareng, Gak Pake Ribet</title>
<meta name="description" content="Academate: hub anti-ribet buat manage kelas, tugas, dan jadwal bareng temen sekelas. Nggak ada lagi drama ketinggalan info." />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css">
<style>
  :root{
    --bg: #F7F7FA;
    --surface: #FFFFFF;
    --text: #1E1F24;
    --muted: #6C6F7F;
    --primary: #6F6CFF;
    --primary-2: #8B7CFF;
    --border: #ECECF1;
    --shadow: 0 10px 30px rgba(30,31,36,.08);
    --radius: 18px;
    --max: 1200px;
  }
  *,*:before,*:after{box-sizing:border-box}
  html{scroll-behavior: smooth;}
  body{
    margin:0; font-family:"Poppins", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, sans-serif;
    background: var(--bg); color: var(--text); overflow-x:hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  a{color:inherit; text-decoration: none;}

  /* Top progress bar */
  .scroll-progress{position:fixed; left:0; top:0; height:4px; width:0%; background:linear-gradient(90deg,var(--primary),var(--primary-2)); z-index:9999; box-shadow:0 2px 6px rgba(111,108,255,.4); transition: width 0.1s linear;}

  /* General Layout */
  .wrap{max-width:var(--max); margin:0 auto; padding:0 20px}
  
  /* Navigation */
  .nav{position:sticky; top:0; z-index:50; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-bottom:1px solid var(--border);
       background: rgba(247, 247, 250, 0.8);}
  .nav-inner{display:flex; align-items:center; justify-content:space-between; height:68px}
  .brand{display:flex; align-items:center; gap:10px; font-weight:700; font-size:20px}
  .logo{width:34px; height:34px; border-radius:10px; background:linear-gradient(135deg,#8B7CFF,#6AC9FF)}
  .nav-links { display: flex; gap: 8px; }
  .nav a.cta{padding:10px 14px; border-radius:12px; text-decoration:none; font-weight:600; border:1px solid transparent;
             background:transparent; color:var(--muted); transition: all 0.2s ease;}
  .nav a.cta:hover { background: var(--surface); color: var(--text); border-color: var(--border); }
  .nav a.cta-primary{background:linear-gradient(135deg,var(--primary),var(--primary-2)); color:#fff; border:none; box-shadow:0 4px 12px rgba(111,108,255,.2)}
  .nav a.cta-primary:hover { filter: brightness(1.1); }
  .mobile-menu-btn { display: none; }

  /* Hero Section */
  .hero{position:relative; padding:64px 0 40px}
  .hero-grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:36px; align-items:center}
  .eyebrow{display:inline-flex; align-items:center; gap:8px; font-size:12px; color:var(--muted); background:#FAFAFE; padding:6px 10px; border-radius:999px; border:1px solid var(--border)}
  .hero h1{font-size:clamp(28px, 5vw, 48px); line-height:1.15; letter-spacing: -0.02em; margin:14px 0 10px; font-weight: 700;}
  .hero h1 .highlight { background:linear-gradient(135deg,var(--primary),var(--primary-2)); -webkit-background-clip:text; background-clip:text; color:transparent; }
  .hero p{color:var(--muted); font-size:clamp(15px, 1.8vw, 18px); line-height: 1.6; margin:0 0 24px}
  .hero-cta{display:flex; gap:12px; flex-wrap:wrap}
  .btn{display:inline-flex; align-items:center; justify-content: center; gap:8px; padding:12px 20px; border-radius:14px; border:1px solid var(--border); background:var(--surface); text-decoration:none; font-weight:600; transition: all .2s;}
  .btn:hover { transform: translateY(-2px); box-shadow: var(--shadow); }
  .btn-primary{background:var(--primary); color:#fff; border:none; box-shadow: 0 6px 20px rgba(111,108,255,.3);}
  .btn-primary:hover { background: var(--primary-2); }
  .subtle{font-size:12px; color:var(--muted)}
  .chips{display:flex; gap:10px; flex-wrap:wrap; margin-top:24px;}
  .chip{display:flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:var(--surface); font-size: 13px; font-weight: 500;}

  /* Phone Mockup */
  .phone-wrap { perspective: 1000px; }
  .phone{aspect-ratio:9/19; background:linear-gradient(180deg,#fff,#f5f6fa); border-radius:32px; border:1px solid var(--border);
         box-shadow:var(--shadow); position:relative; overflow:hidden; transform: rotateX(10deg) rotateY(-15deg); transition: transform 0.5s ease-out;}
  .phone:hover { transform: rotateX(0) rotateY(0); }
  .notch{position:absolute; top:10px; left:50%; transform:translateX(-50%); width:120px; height:18px; border-radius:30px; background:#e9eaf2}
  .screen{position:absolute; inset:16px; border-radius:20px; background:#fff; overflow:hidden; display: flex; flex-direction: column;}
  .screen-content { padding: 16px; flex-grow: 1; overflow-y: auto; }
  .screen-header{display:flex; align-items:center; justify-content:space-between; margin-bottom:12px}
  .badge{font-size:11px; padding:6px 10px; border-radius:999px; background:#F3F2FF; color:var(--primary); font-weight:700}
  .card{background:#fff; border:1px solid var(--border); border-radius:14px; padding:12px; box-shadow:0 4px 12px rgba(0,0,0,.04)}
  .list{display:flex; flex-direction:column; gap:10px}
  .li{display:flex; gap:10px; align-items:center}
  .li .icon{width:38px; height:38px; display:grid; place-items:center; border-radius:12px; background:#F3F2FF; color:var(--text); font-size: 18px;}
  .li .meta{font-size:12px; color:var(--muted)}
  .progress{height:10px; background:#F0F1F6; border-radius:999px; overflow:hidden}
  .progress > i{display:block; height:100%; width:42%; background:linear-gradient(90deg,var(--primary),var(--primary-2))}
  .screen-nav { border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 8px 0; background: #fff; }
  .screen-nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 10px; color: var(--muted); }
  .screen-nav-item.active { color: var(--primary); }

  /* Section Header */
  .section-header { text-align: center; margin-bottom: 40px; }
  .section-header h2 { font-size: clamp(24px, 4vw, 36px); margin: 0 0 8px; }
  .section-header p { max-width: 600px; margin: 0 auto; color: var(--muted); font-size: 16px; line-height: 1.6; }

  /* Scrollytelling Section */
  .pin-grid { display:grid; grid-template-columns: 1fr 1fr; gap:36px; align-items:start; padding:40px 0 60px; }
  .pin-wrap{position:relative; height: 100%;}
  .pin{position:sticky; top:100px}
  .steps{display:flex; flex-direction:column; gap:80px}
  .step{background:transparent; border:none; border-radius:16px; padding:0; box-shadow:none; opacity:.4; transform: scale(.98); transition:transform .5s cubic-bezier(.2,.8,.2,1), opacity .5s; cursor: pointer;}
  .step.active{opacity:1; transform:scale(1)}
  .step h3{margin:0 0 6px; font-size:22px; display: flex; align-items: center; gap: 10px;}
  .step h3 i { color: var(--primary); }
  .step p{margin:0; color:var(--muted); line-height: 1.7;}
  .pin-visual{aspect-ratio:4/3; background:var(--surface); border-radius:16px; border:1px solid var(--border);
              display:flex; align-items:center; justify-content: center; overflow:hidden; box-shadow: var(--shadow); position: relative;}
  
  /* --- SCROLLYTELLING VISUALS TWEAK --- */
  .pin-visual .visual-content {
    width: 100%;
    height: 100%;
    padding: 24px;
    transition: opacity 0.4s ease-in-out;
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0;
    pointer-events: none;
  }
  .pin-visual .visual-content.active {
    opacity: 1;
    pointer-events: auto;
  }
  
  /* Scrollytelling Visuals Content */
  .chat-ui { display: flex; flex-direction: column; gap: 12px; height: 100%; justify-content: flex-end; }
  .chat-bubble { padding: 10px 14px; border-radius: 12px; max-width: 75%; font-size: 14px; line-height: 1.5; }
  .chat-bubble.other { background: #F3F4F6; align-self: flex-start; }
  .chat-bubble.me { background: var(--primary); color: white; align-self: flex-end; }

  .tasks-ui { display: flex; flex-direction: column; gap: 12px; }
  .task-item { display: flex; align-items: center; gap: 12px; background: #F9FAFB; border-radius: 10px; padding: 12px; border: 1px solid var(--border); }
  .task-item .check { width: 20px; height: 20px; border-radius: 6px; border: 2px solid #D1D5DB; }
  .task-item.done .check { background: var(--primary); border-color: var(--primary); }
  .task-item .task-text { flex: 1; font-size: 14px; }
  .task-item .task-due { font-size: 12px; padding: 4px 8px; border-radius: 6px; background: #FEF3C7; color: #92400E; }
  .task-item.done .task-text { text-decoration: line-through; color: var(--muted); }
  .task-item.done .task-due { background: #D1FAE5; color: #065F46; }

  .schedule-ui { display: grid; grid-template-columns: 40px 1fr; gap: 8px; height: 100%; }
  .schedule-times { display: flex; flex-direction: column; justify-content: space-around; font-size: 10px; color: var(--muted); text-align: right; }
  .schedule-body { position: relative; background-image: linear-gradient(to bottom, var(--border) 1px, transparent 1px); background-size: 100% 25%; }
  .schedule-event { position: absolute; left: 4px; right: 4px; border-radius: 8px; padding: 6px; font-size: 12px; color: var(--primary-2); background: #F3F2FF; border-left: 3px solid var(--primary-2); }
  
  .notes-ui { display: flex; flex-direction: column; gap: 12px; }
  .note-item { background: #F9FAFB; border-radius: 10px; padding: 12px; border: 1px solid var(--border); }
  .note-item h4 { font-size: 14px; margin: 0 0 4px; }
  .note-item p { font-size: 13px; margin: 0; color: var(--muted); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  .note-item .note-author { font-size: 11px; margin-top: 8px; color: var(--muted); font-weight: 500;}

  /* "How it works" section */
  .how-it-works-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
  .how-step { background: var(--surface); border-radius: 16px; border: 1px solid var(--border); padding: 24px; text-align: center; }
  .how-step .step-number { font-size: 24px; font-weight: 700; color: var(--primary); background: #F3F2FF; width: 50px; height: 50px; line-height: 50px; border-radius: 50%; margin: 0 auto 16px; }
  .how-step h3 { font-size: 18px; margin: 0 0 8px; }
  .how-step p { color: var(--muted); line-height: 1.6; margin: 0; }
  
  /* CTA section */
  .cta-section{padding:72px 0}
  .cta-box{background:linear-gradient(135deg,var(--primary),var(--primary-2)); color:#fff; border-radius:24px; padding: 48px; text-align: center;}
  .cta-box h2{margin:0 0 12px; font-size:clamp(24px, 4vw, 36px)}
  .cta-box p { max-width: 500px; margin: 0 auto 24px; opacity: 0.9; }
  .cta-actions{display:flex; justify-content: center; gap:12px; flex-wrap:wrap}
  .cta-box .btn{background:#fff; border:none; color: var(--primary-color);}

  footer{padding:40px 0; color:var(--muted); border-top: 1px solid var(--border); margin-top: 60px;}
  .footer-row{display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap: wrap;}
  
  /* Responsive Adjustments */
  @media (max-width: 980px){
    .hero-grid{grid-template-columns: 1fr; text-align: center;}
    .hero p { max-width: 600px; margin-left: auto; margin-right: auto; }
    .hero-cta, .chips { justify-content: center; }
    .phone-wrap { display: none; }
    .pin {position:relative; top:auto; margin-bottom: 24px;}
    .pin-grid{grid-template-columns:1fr}
    .steps { gap: 60px; }
    .how-it-works-grid { grid-template-columns: 1fr; }
  }
  @media (max-width: 768px) {
    .nav-links { display: none; }
    .mobile-menu-btn { display: block; background: none; border: none; font-size: 24px; cursor: pointer; }
    .cta-box { padding: 32px 24px; }
  }
</style>
</head>
<body>
<div class="scroll-progress" id="scroll-progress"></div>

<header class="nav">
  <div class="wrap nav-inner">
    <a href="#" class="brand"><div class="logo" aria-hidden="true"></div>Academate</a>
    <nav class="nav-links">
      <a class="cta" href="#features">Fitur</a>
      <a class="cta" href="#how-it-works">Cara Kerja</a>
      <a class="cta cta-primary" href="auth.html">Mulai Sekarang</a>
    </nav>
    <button class="mobile-menu-btn" aria-label="Menu"><i class="ri-menu-line"></i></button>
  </div>
</header>

<main>
  <!-- HERO -->
  <section class="hero wrap" aria-label="intro">
    <div class="hero-grid">
      <div>
        <span class="eyebrow"><i class="ri-sparkling-2-fill"></i> Kolaborasi Jadi Asik</span>
        <h1>Satu Tempat, Semua Urusan Kuliah. <span class="highlight">Bareng.</span></h1>
        <p>Academate: hub anti-ribet buat manage kelas, tugas, dan jadwal bareng temen sekelas. Nggak ada lagi drama ketinggalan info.</p>
        <div class="hero-cta">
          <a class="btn btn-primary" href="auth.html"><i class="ri-rocket-2-fill"></i>Mulai Gratis</a>
          <a class="btn" href="#features"><i class="ri-play-circle-line"></i>Lihat Fitur</a>
        </div>
        <div class="chips">
          <div class="chip"><i class="ri-group-2-line" style="color: var(--primary);"></i> Kelas Kolaboratif</div>
          <div class="chip"><i class="ri-task-line" style="color: var(--primary);"></i> Tugas Dikelola Bersama</div>
          <div class="chip"><i class="ri-calendar-2-line" style="color: var(--primary);"></i> Jadwal Selalu Update</div>
        </div>
      </div>
      <div class="phone-wrap" aria-hidden="true">
        <div class="phone">
          <div class="notch"></div>
          <div class="screen">
            <div class="screen-content">
              <div class="screen-header">
                <span class="badge">Tugas Hari Ini</span>
                <span class="subtle">5 Okt</span>
              </div>
              <div class="card" style="margin-bottom:12px">
                <div style="font-size:11px; color: var(--muted); margin-bottom: 4px;">Progress Mingguan</div>
                <div class="progress"><i style="width:64%"></i></div>
              </div>
              <div class="list">
                <div class="li"><div class="icon">📐</div><div>
                  <div style="font-weight:600; font-size:14px">Aljabar Linear</div>
                  <div class="meta">Ruang 203 • 09:40</div></div></div>
                <div class="li"><div class="icon">🧪</div><div>
                  <div style="font-weight:600; font-size:14px">Praktikum Kimia</div>
                  <div class="meta">Laporan Bab 3 • Tenggat hari ini</div></div></div>
                <div class="li"><div class="icon">💻</div><div>
                  <div style="font-weight:600; font-size:14px">Dasar Pemrograman Web</div>
                  <div class="meta">Presentasi prototipe • Jumat</div></div></div>
              </div>
            </div>
            <nav class="screen-nav">
                <div class="screen-nav-item active"><i class="ri-dashboard-2-line"></i><span>Dasbor</span></div>
                <div class="screen-nav-item"><i class="ri-book-open-line"></i><span>Kelas</span></div>
                <div class="screen-nav-item"><i class="ri-task-line"></i><span>Tugas</span></div>
                <div class="screen-nav-item"><i class="ri-calendar-2-line"></i><span>Jadwal</span></div>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SCROLLYTELLING FEATURES -->
  <section id="features" class="wrap" style="padding: 80px 0;">
    <div class="section-header">
      <h2>Dibangun untuk Kolaborasi, Bukan Cuma Organisasi</h2>
      <p>Ini bukan cuma agenda biasa. Academate adalah ruang hidup tempat semua anggota kelas bisa berkontribusi.</p>
    </div>
    <div class="pin-grid">
      <div class="pin-wrap">
        <div class="pin">
          <div class="pin-visual">
            <div id="visual-chat" class="visual-content">
                <div class="chat-ui">
                    <div class="chat-bubble other">Guys, jangan lupa besok presentasi kelompok ya!</div>
                    <div class="chat-bubble me">Aman, slide presentasiku sudah selesai.</div>
                    <div class="chat-bubble other">Mantap! Aku bagian demo aplikasi.</div>
                </div>
            </div>
            <div id="visual-tasks" class="visual-content">
                <div class="tasks-ui">
                    <div class="task-item done">
                        <div class="check"></div>
                        <div class="task-text">Rangkuman Bab 3 & 4</div>
                        <div class="task-due">Selesai</div>
                    </div>
                    <div class="task-item">
                        <div class="check"></div>
                        <div class="task-text">Laporan Praktikum Modul 2</div>
                        <div class="task-due">Besok</div>
                    </div>
                    <div class="task-item">
                        <div class="check"></div>
                        <div class="task-text">Tugas Besar: Desain UI/UX</div>
                        <div class="task-due" style="background: #FEE2E2; color: #991B1B;">3 Hari Lagi</div>
                    </div>
                </div>
            </div>
            <div id="visual-schedule" class="visual-content">
                <div class="schedule-ui">
                    <div class="schedule-times"><span>08:00</span><span>10:00</span><span>12:00</span><span>14:00</span></div>
                    <div class="schedule-body">
                        <div class="schedule-event" style="top: 10%; height: 25%;">Aljabar Linear</div>
                        <div class="schedule-event" style="top: 40%; height: 35%; background: #E0F2FE; color: #0284C7; border-color: #0284C7;">Struktur Data</div>
                        <div class="schedule-event" style="top: 80%; height: 18%;">Bahasa Inggris</div>
                    </div>
                </div>
            </div>
            <div id="visual-notes" class="visual-content">
              <div class="notes-ui">
                  <div class="note-item">
                      <h4>Rangkuman Ujian Tengah Semester</h4>
                      <p>Berikut poin-poin penting dari Bab 1 sampai 5 untuk persiapan ujian...</p>
                      <div class="note-author">Dibagikan oleh Budi</div>
                  </div>
                   <div class="note-item">
                      <h4>Ide Tugas Kelompok</h4>
                      <p>Gimana kalau kita ambil tema A untuk proyek akhir? Sepertinya lebih menarik...</p>
                      <div class="note-author">Dibagikan oleh Citra</div>
                  </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="steps" id="steps">
        <article class="step" data-visual="visual-chat">
          <h3><i class="ri-group-2-line"></i>Basecamp Tiap Kelas</h3>
          <p>Tiap kelas punya basecamp chat sendiri. Koordinasi tugas, sharing materi, atau nanya-nanya jadi sat-set tanpa pindah aplikasi.</p>
        </article>
        <article class="step" data-visual="visual-tasks">
          <h3><i class="ri-user-add-line"></i>Tugas dari Siapa Saja</h3>
          <p>Bukan cuma dosen, semua member bisa nambahin tugas. Ada tugas dadakan dari teman? Langsung masukin. Semua jadi tahu, nggak ada yang ketinggalan.</p>
        </article>
        <article class="step" data-visual="visual-schedule">
          <h3><i class="ri-calendar-check-line"></i>Kalender yang Hidup</h3>
          <p>Kalender kelas yang update otomatis. Jadwal & deadline tugas yang ditambahin teman langsung muncul di sini. Nggak ada lagi tuh ‘eh, aku lupa!’</p>
        </article>
        <article class="step" data-visual="visual-notes">
            <h3><i class="ri-file-edit-line"></i>Catatan Dibuat Bareng</h3>
            <p>Satu halaman buat semua catatan penting. Ada yang nyatet pas kelas? Langsung share. Bikin rangkuman bareng buat ujian jadi lebih gampang.</p>
        </article>
      </div>
    </div>
  </section>

  <!-- HOW IT WORKS -->
  <section id="how-it-works" class="wrap" style="padding:40px 0 80px">
    <div class="section-header">
        <h2>Gotong Royong Digital, Mulainya Gampang</h2>
        <p>Mulai kolaborasi bareng sekelas dalam hitungan menit.</p>
    </div>
    <div class="how-it-works-grid">
        <div class="how-step">
            <div class="step-number">1</div>
            <h3>Bikin atau Join Circle</h3>
            <p>Bikin kelas baru, atau join pake kode dari teman. Langsung masuk circle dan semua info otomatis sinkron.</p>
        </div>
        <div class="how-step">
            <div class="step-number">2</div>
            <h3>Kontribusi Info Pertamamu</h3>
            <p>Input tugas atau jadwal yang kamu tahu. Karena semua bisa kontribusi, yang lain bakal bantu melengkapi.</p>
        </div>
        <div class="how-step">
            <div class="step-number">3</div>
            <h3>Gas Kolaborasi!</h3>
            <p>Langsung diskusi di chat, update tugas bareng, dan share catatan. Semua info penting jadi satu, nggak ada lagi yang miskom.</p>
        </div>
    </div>
  </section>

  <!-- CTA -->
  <section id="get-started" class="cta-section">
    <div class="wrap">
      <div class="cta-box">
        <h2>Ubah Cara Kamu Berkolaborasi di Kelas.</h2>
        <p>Daftar gratis dan undang teman sekelasmu. Rasakan bedanya ngampus bareng-bareng di satu platform.</p>
        <div class="cta-actions">
          <a class="btn" href="auth.html"><i class="ri-google-fill"></i> Lanjutkan dengan Google</a>
        </div>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="wrap footer-row">
    <span>&copy; 2025 Academate</span>
  </div>
</footer>

<script>
  // --- ROBUST SCROLL SCRIPT ---

  // Top scroll progress bar
  const progressBar = document.getElementById('scroll-progress');
  function updateProgressBar() {
    if (!progressBar) return;
    const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
    const totalScrollable = scrollHeight - clientHeight;
    const scrollPercent = totalScrollable > 0 ? (scrollTop / totalScrollable) * 100 : 0;
    progressBar.style.width = `${scrollPercent}%`;
  }
  function animationLoop() {
    updateProgressBar();
    requestAnimationFrame(animationLoop);
  }
  requestAnimationFrame(animationLoop);

  // Scrollytelling logic
  const steps = document.querySelectorAll('.step');
  const visualContents = document.querySelectorAll('.pin-visual .visual-content');
  const pinGrid = document.querySelector('.pin-grid');

  if (pinGrid && steps.length > 0 && visualContents.length > 0) {
    let currentStepIndex = 0;
    let isAnimating = false;
    const animationDuration = 1000; // This is the 'effort'. Lock interaction for 1s.

    function setActiveStep(index, scrollBehavior = 'smooth') {
      if (index < 0 || index >= steps.length || (index === currentStepIndex && scrollBehavior !== 'auto')) return;

      currentStepIndex = index;

      steps.forEach(step => step.classList.remove('active'));
      visualContents.forEach(content => content.classList.remove('active'));

      steps[index].classList.add('active');
      const visualId = steps[index].dataset.visual;
      const activeVisual = document.getElementById(visualId);
      if (activeVisual) {
        activeVisual.classList.add('active');
      }

      steps[index].scrollIntoView({
        behavior: scrollBehavior,
        block: 'center'
      });
    }

    // Initialize first step without smooth scroll on page load
    setActiveStep(0, 'auto');

    // Click navigation
    steps.forEach((step, index) => {
      step.addEventListener('click', () => {
        if (isAnimating || currentStepIndex === index) return;

        isAnimating = true;
        setActiveStep(index, 'smooth');

        setTimeout(() => {
          isAnimating = false;
        }, animationDuration);
      });
    });

    // --- SCROLL & TOUCH CONTROL LOGIC ---
    const handleInteraction = (deltaY) => {
      if (isAnimating) return;

      let nextStepIndex = currentStepIndex;

      // Thresholds to prevent firing on minor movements
      if (deltaY > 20 && currentStepIndex < steps.length - 1) { // Scroll down
        nextStepIndex++;
      } else if (deltaY < -20 && currentStepIndex > 0) { // Scroll up
        nextStepIndex--;
      }

      if (nextStepIndex !== currentStepIndex) {
        isAnimating = true;
        setActiveStep(nextStepIndex, 'smooth');
        setTimeout(() => {
          isAnimating = false;
        }, animationDuration);
      }
    };

    const handleWheel = (e) => {
      if (isAnimating) {
        e.preventDefault();
        return;
      }
      const isScrollingDown = e.deltaY > 0;
      const isAtFirstStep = currentStepIndex === 0;
      const isAtLastStep = currentStepIndex === steps.length - 1;
      
      // If at the top and scrolling up, or at the bottom and scrolling down, allow default behavior.
      if ((!isScrollingDown && isAtFirstStep) || (isScrollingDown && isAtLastStep)) {
        return;
      }
      
      // Otherwise, we are navigating between steps, so prevent default and handle it.
      e.preventDefault();
      handleInteraction(e.deltaY);
    };

    let touchStartY = 0;
    let touchEndY = 0;
    const touchThreshold = 30; // Min swipe distance in pixels

    const handleTouchStart = (e) => {
      touchStartY = e.touches[0].clientY;
      touchEndY = 0; // Reset endY on new touch
    };

    const handleTouchMove = (e) => {
      // We don't prevent default here to avoid trapping the user.
      // The page might scroll a bit during the swipe, but it will snap on touchend.
      touchEndY = e.touches[0].clientY;
    };
    
    const handleTouchEnd = (e) => {
      if (isAnimating || touchEndY === 0) return;
      
      const deltaY = touchStartY - touchEndY; // Positive for swipe up (scrolling down)
      
      if (Math.abs(deltaY) > touchThreshold) {
          const isSwipingDown = deltaY > 0;
          const isAtFirstStep = currentStepIndex === 0;
          const isAtLastStep = currentStepIndex === steps.length - 1;
          
          // Check if the user is trying to swipe out of the section
          if ((!isSwipingDown && isAtFirstStep) || (isSwipingDown && isAtLastStep)) {
              return; // Do nothing, allow native scroll
          }

          // If we're here, it's a swipe between steps
          handleInteraction(deltaY);
      }
      // Reset values
      touchStartY = 0;
      touchEndY = 0;
    };

    // This observer applies/removes the scroll/touch listeners
    const observer = new IntersectionObserver((entries) => {
      const [entry] = entries;
      if (entry.isIntersecting) {
        document.addEventListener('wheel', handleWheel, { passive: false });
        document.addEventListener('touchstart', handleTouchStart, { passive: false });
        document.addEventListener('touchmove', handleTouchMove, { passive: false });
        document.addEventListener('touchend', handleTouchEnd, { passive: false });
      } else {
        document.removeEventListener('wheel', handleWheel, { passive: false });
        document.removeEventListener('touchstart', handleTouchStart, { passive: false });
        document.removeEventListener('touchmove', handleTouchMove, { passive: false });
        document.removeEventListener('touchend', handleTouchEnd, { passive: false });
      }
    }, {
      // A smaller rootMargin makes the "activation zone" larger and feel more natural.
      rootMargin: "-40% 0px -40% 0px",
      threshold: 0
    });

    observer.observe(pinGrid);
  }
</script>
</body>
</html>

