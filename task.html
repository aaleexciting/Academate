<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tugas â€” Academate</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css">

  <style>
    :root{
      --bg:#F7F7FA;--surface:#fff;--text:#1E1F24;--muted:#6C6F7F;--primary:#6F6CFF;--primary-2:#8B7CFF;--border:#ECECF1;--shadow:0 6px 24px rgba(30,31,36,.07);--radius:18px;--sidebar-w:280px;--content-max:1320px;--gap:18px;
      --success:#10B981;--warn:#F59E0B;--danger:#EF4444;--info:#3B82F6;
      --urgent: #fde2e2; --urgent-text: #c82424;
      --soon: #fef3c7; --soon-text: #b45309;
      --safe: #dcfce7; --safe-text: #15803d;
    }
    html{height:100%} 
    *{box-sizing:border-box}
    body{margin:0;font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;font-size:15px;padding-bottom:90px} 
    a{color:inherit; text-decoration: none;}

    .app{padding:var(--gap);width:100%;max-width:1700px;margin:0 auto;min-height:100dvh}
    .main{background:var(--surface);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    .main-content{padding:var(--gap);width:100%}

    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:var(--surface);cursor:pointer;font-weight:600;text-decoration:none;transition:.2s}
    .btn:hover{border-color:#d8d8e0}
    .btn-primary{background:var(--primary);color:#fff;border-color:transparent;box-shadow:0 6px 18px rgba(111,108,255,.28)}
    .btn-primary:hover{filter:brightness(.98)}
    .icon-btn{width:42px;height:42px;border-radius:50%;border:1px solid var(--border);background:var(--surface);display:grid;place-items:center;cursor:pointer;color:var(--muted);font-size:20px;transition:.2s;flex-shrink:0}
    .icon-btn:hover{color:var(--primary);border-color:#d8d8e0}

    .header{margin-top:var(--gap);margin-bottom:24px}
    .header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .header-brand{font-size:20px;font-weight:700;background:linear-gradient(135deg,var(--primary),var(--primary-2));-webkit-background-clip:text;background-clip:text;color:transparent;display:inline-block}
    .header-actions{display:flex;gap:8px}
    .header-actions .icon-btn{width:38px;height:38px;font-size:18px}
    .header-main{display:flex;justify-content:space-between;align-items:center;gap:16px}
    .header-main h1{font-size:22px;margin:0}
    .header-main p{color:var(--muted);margin:4px 0 0;font-size:14px}
    .header-avatar-link{text-decoration:none}
    .header-avatar{width:42px;height:42px;border-radius:50%;object-fit:cover;border:2px solid var(--border);flex-shrink:0}
    .header-toolbar{display:none}

    .mobile-nav{position:fixed;bottom:0;left:0;right:0;background:rgba(255,255,255,.8);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-top:1px solid var(--border);display:flex;justify-content:space-around;align-items:center;height:70px;padding:0 10px;z-index:1000}
    .mobile-nav a{display:flex;flex-direction:column;align-items:center;gap:4px;color:var(--muted);text-decoration:none;font-size:10px;font-weight:500;padding:8px;border-radius:8px}
    .mobile-nav a i{font-size:20px}
    .mobile-nav a.active{color:var(--primary)}

    .sidebar{display:none}
    .page-grid{display:flex;flex-direction:column;gap:var(--gap)}
    
    .sk{position:relative;overflow:hidden;background:#F2F3F7 !important;border-radius:10px}
    .sk::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.6),transparent);transform:translateX(-100%);animation:shimmer 1.2s infinite}
    @keyframes shimmer{100%{transform:translateX(100%)}}
    .skeleton-wrapper.hidden { display: none; }

    @media (min-width:901px){
      body{padding-bottom:0}
      .mobile-nav{display:none}
      .app{display:grid;grid-template-columns:var(--sidebar-w) minmax(0,1fr);gap:24px}
      .sidebar{display:flex;flex-direction:column;background:var(--surface);border-radius:var(--radius);box-shadow:var(--shadow);padding:24px}
      .brand{display:flex;align-items:center;gap:12px;font-weight:700;font-size:22px;margin-bottom:18px}
      .brand .logo{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,#8B7CFF,#6AC9FF)}
      .nav{display:flex;flex-direction:column;gap:8px;overflow:auto;padding-right:2px}
      .nav a{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:12px;color:var(--muted);text-decoration:none;font-weight:500;transition:.2s}
      .nav a i{font-size:20px}
      .nav a:hover{background:#F3F2FF;color:var(--primary)}
      .nav a.active{background:var(--primary);color:#fff;box-shadow:0 8px 20px rgba(111,108,255,.3)}
      .spacer{flex:1}
      .sidebar-footer{margin-top:auto;padding-top:16px;border-top:1px solid var(--border)}
      .sidebar-logout-btn{width:100%;display:flex;align-items:center;justify-content:center;gap:10px;padding:12px;border-radius:12px;background:transparent;border:1px solid var(--border);color:var(--muted);font-weight:600;cursor:pointer;transition:.2s}
      .sidebar-logout-btn:hover{background:#fde2e2;border-color:#f7b2b2;color:#c82424}
      .sidebar-links{text-align:center;margin-top:16px;display:flex;justify-content:center;gap:16px}
      .sidebar-links a{font-size:12px;color:var(--muted);text-decoration:none}
      .sidebar-links a:hover{text-decoration:underline}
      .copyright{font-size:11px;color:#C0C3D2;text-align:center;margin-top:12px}
      .main-content{max-width:min(var(--content-max),calc(100vw - var(--sidebar-w) - 120px));margin:0 auto}
      .header{display:flex;justify-content:space-between;align-items:center}
      .header-top,.header-avatar-link,.header-actions{display:none}
      .header-main{display:block}
      .header-main h1{font-size:26px}
      .header-main p{font-size:15px;margin-top:6px}
      .header-toolbar{display:flex;align-items:center;gap:12px}
      .search-bar{position:relative; flex-grow: 1; max-width: 420px;}
      .search-bar input{width:100%;padding:12px 16px 12px 44px;border-radius:12px;border:1px solid var(--bg);background:var(--bg);outline:none;transition:.2s}
      .search-bar input:focus{border-color:var(--primary);background:var(--surface)}
      .search-bar i{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:var(--muted)}
      .brand .logo {
  width: 34px;
  height: 34px;
  border-radius: 10px;
  background: linear-gradient(135deg, #8B7CFF, #6AC9FF);
  
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  padding: 6px;
}

.brand .logo svg {
  width: 100%;
  height: 100%;
}
    }

    .progress-summary-v3 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--gap);
    }
    .progress-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 20px;
        transition: box-shadow .2s ease-out, transform .2s ease-out;
    }
    .progress-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow);
    }
    .progress-card.progress-main {
        grid-column: 1 / -1;
    }
    .progress-main h3 { margin: 0 0 4px; font-size: 16px; font-weight: 600; }
    .progress-main p { margin: 0 0 12px; color: var(--muted); font-size: 14px; }
    .progress-main p span { font-weight: 600; color: var(--text); }
    .progress-bar-v3 { height: 10px; background-color: var(--bg); border-radius: 999px; overflow: hidden; }
    .progress-bar-inner-v3 { height: 100%; width: 0%; background: var(--primary); border-radius: 999px; transition: width 0.6s cubic-bezier(0.25, 1, 0.5, 1); }
    
    .progress-card:not(.progress-main) {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 16px;
    }
    .progress-card .icon-wrapper {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        display: grid;
        place-items: center;
        background-color: var(--icon-bg);
        color: var(--icon-color);
        font-size: 22px;
        flex-shrink: 0;
    }
    .progress-card .value {
        font-size: 24px;
        font-weight: 700;
        line-height: 1.1;
    }
    .progress-card .label {
        font-size: 14px;
        color: var(--muted);
        margin-top: 2px;
    }

    @media (min-width: 640px) {
        .progress-summary-v3 { grid-template-columns: 2fr 1fr 1fr; }
        .progress-card.progress-main { grid-column: auto; }
    }

    .toolbar{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}

    .tabs{
        display: inline-flex;
        background: var(--bg);
        border-radius: 12px;
        padding: 4px;
    }
    .tab-btn{
        padding: 8px 14px;
        border: none;
        background: none;
        border-radius: 10px;
        font-weight: 600;
        color: var(--muted);
        cursor: pointer;
        transition: all .2s;
    }
    .tab-btn.active{
        background: var(--surface);
        color: var(--text);
        box-shadow: 0 3px 12px rgba(0,0,0,0.08);
    }
    .tab-btn:not(.active):hover { color: var(--primary); }

    .custom-select-container { min-width: 200px; }
    .custom-select-wrapper { position: relative; }
    .custom-select-wrapper .custom-select-trigger {
        width: 100%;
        justify-content: space-between;
    }
    .custom-select-options {
        position: absolute;
        top: calc(100% + 6px);
        left: 0;
        right: 0;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 6px;
        box-shadow: var(--shadow);
        z-index: 10;
        opacity: 0;
        visibility: hidden;
        transform: translateY(10px);
        transition: opacity .2s, transform .2s, visibility .2s;
        max-height: 250px;
        overflow-y: auto;
    }
    .custom-select-wrapper.open .custom-select-options {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }
    .custom-select-option {
        padding: 10px 14px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .custom-select-option:hover { background: var(--bg); }
    .custom-select-option.selected {
        background: #F3F2FF;
        color: var(--primary);
        font-weight: 600;
    }

    .task-list{display:grid;gap:12px;margin-top: var(--gap);}
    .task-card-v2 { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; transition: box-shadow .2s; }
    .task-card-v2:hover { box-shadow: 0 8px 24px rgba(0,0,0,0.06); }
    .task-main-row { display: flex; align-items: center; gap: 16px; padding: 16px; }
    .custom-checkbox { width: 22px; height: 22px; border-radius: 6px; border: 2px solid var(--border); flex-shrink: 0; cursor: pointer; transition: all .2s; display: grid; place-items: center; }
    .custom-checkbox:hover { border-color: var(--primary); }
    .is-done .custom-checkbox { background-color: var(--primary); border-color: var(--primary); color: white; }
    .task-icon-bg-v2 { width: 40px; height: 40px; border-radius: 10px; display: grid; place-items: center; flex-shrink: 0; font-size: 20px; }
    .task-content-v2 { flex-grow: 1; min-width: 0; }
    .task-content-v2 h4 { margin: 0; font-size: 15px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .task-meta-v2 { margin-top: 4px; display: flex; flex-wrap: wrap; align-items: center; gap: 6px 10px; }
    .meta-item { color: var(--muted); font-size: 13px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .time-chip-v2 { display: inline-flex; align-items: center; gap: 6px; padding: 5px 10px; border-radius: 8px; font-size: 12px; font-weight: 600; }
    .time-chip-v2.safe { background: var(--safe); color: var(--safe-text); }
    .time-chip-v2.urgent { background: var(--urgent); color: var(--urgent-text); }
    .time-chip-v2.soon { background: var(--soon); color: var(--soon-text); }
    .time-chip-v2.overdue { background: #e2e2e7; color: #50525d; }
    .detail-btn { padding: 8px 14px; border-radius: 10px; background-color: #F3F2FF; border: 1px solid transparent; color: var(--primary); font-weight: 600; cursor: pointer; transition: all .2s; }
    .detail-btn:hover { filter: brightness(0.95); }
    .detail-btn i { transition: transform .2s ease; }
    .expanded .detail-btn i { transform: rotate(180deg); }
    .task-description-v2 { max-height: 0; overflow: hidden; transition: max-height .3s ease-out, padding .3s ease-out; }
    .task-description-content-v2 { padding: 0 20px 20px; color: var(--muted); font-size: 14px; line-height: 1.6; }
    .expanded .task-description-v2 { max-height: 500px; }
    .is-done h4, .is-done .meta-item { text-decoration: line-through; color: #b0b4c3; }
    
    .task-center-content { flex-grow: 1; display: flex; align-items: center; gap: 16px; min-width: 0; }
    .task-actions-wrapper { display: flex; align-items: center; gap: 16px; margin-left: auto; flex-shrink: 0; }
    .task-completers-wrapper { flex-shrink: 0; }

    .task-avatar-stack { display: flex; }
    .task-avatar-stack .avatar { width: 28px; height: 28px; border-radius: 50%; object-fit: cover; border: 2px solid var(--surface); margin-left: -10px; transition: transform .2s; background-color: var(--border); }
    .task-avatar-stack .avatar:first-child { margin-left: 0; }
    .task-avatar-stack .avatar:hover { transform: translateY(-2px); z-index: 1; }
    .task-avatar-stack .more-avatars { width: 28px; height: 28px; border-radius: 50%; background: var(--bg); border: 2px solid var(--surface); margin-left: -10px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; color: var(--muted); }
    
    .completers-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .completers-checkmark {
        width: 24px;
        height: 24px;
        background-color: var(--success);
        color: white;
        border-radius: 50%;
        display: grid;
        place-items: center;
        font-size: 16px;
        flex-shrink: 0;
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);
    }
    .task-completers.with-separator { padding-top: 16px; margin-top: 16px; border-top: 1px solid var(--border); }
    .completers-info { font-size: 13px; color: var(--muted); }

    .empty{ text-align:center; padding:40px; border:2px dashed var(--border); border-radius:14px; background:var(--surface); color:var(--muted); margin-top: var(--gap); }

    .modal-overlay{ position:fixed; inset:0; background: rgba(30, 31, 36, 0.6); backdrop-filter: blur(5px); display:none; align-items:center; justify-content:center; z-index:1000; animation: fade-in .2s; }
    .modal-overlay.show { display: flex; }
    @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
    .modal{ background:var(--surface); width: min(95vw, 560px); border-radius:var(--radius); padding:24px; box-shadow:var(--shadow); animation: modal-pop .3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @keyframes modal-pop { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    .modal h2{ margin:0 0 16px; font-size: 20px; }
    .modal-form{ display:grid; grid-template-columns:1fr 1fr; gap:14px }
    .form-group{ display:flex; flex-direction:column; gap: 6px; }
    .form-group label{ font-weight:600; font-size:14px }
    .form-group input, .form-group select, .form-group textarea{ padding:10px 14px; border-radius:10px; border:1px solid var(--border); background:var(--bg); font: inherit; transition: .2s; }
    .form-group textarea{ min-height:90px; resize:vertical }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus{ outline:none; border-color:var(--primary); box-shadow: 0 0 0 3px #6f6cff3b; }
    .full{ grid-column:1 / -1 }
    .modal-actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:16px; grid-column:1 / -1 }

    @media (max-width: 900px) {
        #global-search { display: none; }
    }
    
    @media (max-width: 520px) {
        .app, .main-content { padding: 12px; }
        .header-main h1 { font-size: 20px; }
        .header-main p { font-size: 13px; line-height: 1.4; }
        .toolbar { flex-direction: column; align-items: stretch; gap: 12px; }
        .toolbar .tabs { display: grid; grid-template-columns: 1fr 1fr; width: 100%; }
        .toolbar .custom-select-container { width: 100%; min-width: unset; }
        
        .task-main-row {
            display: grid;
            grid-template-columns: auto 1fr auto; /* checkbox | content | actions */
            align-items: center;
            gap: 12px;
            padding: 12px;
        }
        .task-center-content { gap: 12px; }
        .task-actions-wrapper { flex-direction: column; align-items: flex-end; gap: 6px; }
        .detail-btn {
            padding: 8px;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            display: grid;
            place-items: center;
        }
        
        .completers-checkmark { width: 20px; height: 20px; font-size: 12px; }
        .task-avatar-stack .avatar, .task-avatar-stack .more-avatars {
            width: 22px; height: 22px; margin-left: -10px; border-width: 1.5px; font-size: 9px;
        }
    }

    @media (max-width: 375px) {
        .task-main-row { gap: 8px; padding: 10px; }
        .task-icon-bg-v2 { width: 36px; height: 36px; }
        .task-content-v2 h4 { font-size: 14px; }
        .meta-item { font-size: 12px; }
        .detail-btn { width: 36px; height: 36px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar" aria-label="Navigasi utama">
<div class="brand">
  <div class="logo" aria-hidden="true">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
      <g>
        <path d="M4 4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h6c.494 0 .96-.12 1.37-.33A6.49 6.49 0 0 1 11 17.5a6.48 6.48 0 0 1 2-4.69V7a1 1 0 0 1 1-1h6v5.498a6.52 6.52 0 0 1 2 1.312V6a2 2 0 0 0-2-2h-6c-.768 0-1.47.289-2 .764A2.989 2.989 0 0 0 10 4H4Zm7 3v10a1 1 0 0 1-1 1H4V6h6a1 1 0 0 1 1 1Z"/>
        <path d="M16.007 17c.04-1.415.248-2.669.553-3.585c.171-.513.364-.893.554-1.134c.195-.247.329-.281.386-.281c.057 0 .192.034.386.281c.19.241.383.62.554 1.134c.305.916.513 2.17.553 3.585h-2.986Zm-.396-3.9c.108-.323.23-.622.368-.887A5.504 5.504 0 0 0 12.023 17h2.984c.04-1.5.26-2.866.604-3.9Zm3.778 0a6.133 6.133 0 0 0-.368-.887A5.504 5.504 0 0 1 22.978 17h-2.985c-.04-1.5-.26-2.866-.604-3.9Zm.604 4.9h2.985a5.504 5.504 0 0 1-3.957 4.787c.138-.265.26-.564.368-.886c.345-1.035.564-2.4.604-3.901Zm-2.107 4.719c-.194.247-.329.281-.386-.281c-.057 0-.191-.034-.386-.281c-.19-.241-.383-.62-.554-1.135c-.305-.915-.513-2.17-.553-3.584h2.986c-.04 1.415-.248 2.669-.553 3.584c-.171.514-.364.894-.554 1.135ZM12.023 18a5.504 5.504 0 0 0 3.956 4.787a6.133 6.133 0 0 1-.367-.886c-.346-1.035-.565-2.4-.605-3.901h-2.984Z"/>
      </g>
    </svg>
  </div>
  Academate
</div>      <nav class="nav">
        <a href="dashboard.html"><i class="ri-dashboard-2-line"></i><span>Dasbor</span></a>
        <a href="classes.html"><i class="ri-book-open-line"></i><span>Kelas</span></a>
        <a class="active" href="task.html"><i class="ri-task-line"></i><span>Tugas</span></a>
        <a href="schedule.html"><i class="ri-calendar-2-line"></i><span>Jadwal</span></a>
        <a href="notes.html"><i class="ri-file-list-3-line"></i><span>Catatan</span></a>
        <a href="account.html"><i class="ri-user-3-line"></i><span>Akun</span></a>
      </nav>
      <div class="spacer"></div>
      <div class="sidebar-footer">
        <button id="logout-button-desktop" class="sidebar-logout-btn" type="button" title="Keluar"><i class="ri-logout-box-r-line"></i><span>Keluar</span></button>
<div class="sidebar-links"><a href="legal.html#terms">Terms of Service</a><a href="legal.html#privacy">Privacy Policy</a></div>        <p class="copyright">&copy; 2025 Academate</p>
      </div>
    </aside>

    <main class="main">
      <div class="main-content">
        
        <div class="skeleton-wrapper">
            <header class="header">
                <div class="header-top">
                    <div class="header-brand">Academate</div>
                    <div class="header-actions">
                        <div class="icon-btn sk" style="width:38px;height:38px; border-radius:50%;"></div>
                        <div class="icon-btn sk" style="width:38px;height:38px; border-radius:50%;"></div>
                    </div>
                </div>
                <div class="header-main">
                    <div>
                        <div class="sk" style="height:22px; width:150px; border-radius:8px;"></div>
                        <div class="sk" style="height:14px; width:250px; margin-top: 8px; border-radius:6px;"></div>
                    </div>
                </div>
            </header>
            <div class="page-grid" id="skeleton-grid">
                <section class="progress-summary-v3">
                    <div class="progress-card progress-main" style="border:none; box-shadow: none;">
                        <div class="sk" style="height:18px;width:60%;margin-bottom:8px;"></div>
                        <div class="sk" style="height:14px;width:40%;margin-bottom:14px;"></div>
                        <div class="sk" style="height:10px;width:100%;"></div>
                    </div>
                    <div class="progress-card" style="border:none; box-shadow: none;">
                         <div class="sk" style="width:44px; height:44px; border-radius: 50%; flex-shrink:0;"></div>
                         <div style="flex-grow: 1;">
                            <div class="sk" style="height:22px; width: 40%; margin-bottom: 6px;"></div>
                            <div class="sk" style="height:14px; width: 70%;"></div>
                         </div>
                    </div>
                     <div class="progress-card" style="border:none; box-shadow: none;">
                         <div class="sk" style="width:44px; height:44px; border-radius: 50%; flex-shrink:0;"></div>
                         <div style="flex-grow: 1;">
                            <div class="sk" style="height:22px; width: 40%; margin-bottom: 6px;"></div>
                            <div class="sk" style="height:14px; width: 70%;"></div>
                         </div>
                    </div>
                </section>
                <section>
                    <div class="toolbar">
                        <div class="sk" style="height:44px; flex-grow: 1; border-radius: 12px;"></div>
                        <div class="sk" style="height:44px; width: 200px; border-radius: 12px;"></div>
                    </div>
                </section>
                <section id="skeleton-task-list" class="task-list"></section>
            </div>
        </div>

        <div id="actual-content" style="display: none;">
            <header class="header">
              <div class="header-top">
                <div class="header-brand">Academate</div>
                <div class="header-actions">
                  <button class="icon-btn" title="Cari"><i class="ri-search-line"></i></button>
                  <button class="icon-btn" title="Notifikasi"><i class="ri-notification-3-line"></i></button>
                </div>
              </div>
              <div class="header-main">
                <div>
                  <h1>Manajemen Tugas</h1>
                  <p>Lacak semua tugas dari semua kelas Anda di satu tempat terpusat.</p>
                </div>
                <a href="account.html" class="header-avatar-link"><img id="header-avatar-img" class="header-avatar" alt="Foto profil"></a>
              </div>
              <div class="header-toolbar">
                <div class="search-bar">
                  <i class="ri-search-line"></i>
                  <input id="global-search" type="text" placeholder="Cari tugas...">
                </div>
                <button class="btn btn-primary" id="open-create-modal"><i class="ri-add-line"></i><span>Tambah Tugas</span></button>
              </div>
            </header>

            <div class="page-grid">
              <section id="progress-section" class="progress-summary-v3"></section>
              <section>
                <div class="toolbar">
                  <div class="tabs">
                    <button class="tab-btn active" data-tab="active">Aktif</button>
                    <button class="tab-btn" data-tab="completed">Selesai</button>
                  </div>
                  <div class="custom-select-container">
                    <div class="custom-select-wrapper">
                      <input type="hidden" id="class-filter-value" value="all">
                      <div class="custom-select-trigger btn" tabindex="0">
                          <span id="selected-class-name">Semua Kelas</span>
                          <i class="ri-arrow-down-s-line"></i>
                      </div>
                      <div class="custom-select-options"></div>
                    </div>
                  </div>
                </div>
              </section>
              <section aria-live="polite">
                <div id="list-container"></div>
                <div id="empty" class="empty" style="display:none">Tidak ada tugas di sini. Kerja bagus! ðŸ˜Ž</div>
              </section>
            </div>
        </div>
      </div>
    </main>
  </div>

  <nav class="mobile-nav">
    <a href="dashboard.html"><i class="ri-dashboard-2-line"></i><span>Dasbor</span></a>
    <a href="classes.html"><i class="ri-book-open-line"></i><span>Kelas</span></a>
    <a class="active" href="task.html"><i class="ri-task-line"></i><span>Tugas</span></a>
    <a href="schedule.html"><i class="ri-calendar-2-line"></i><span>Jadwal</span></a>
    <a href="notes.html"><i class="ri-file-list-3-line"></i><span>Catatan</span></a>
  </nav>

  <div class="modal-overlay" id="create-task-modal">
    <div class="modal">
      <h2>Buat Tugas Baru</h2>
      <form id="create-task-form" class="modal-form">
        <div class="form-group full"><label for="task-title">Judul Tugas</label><input id="task-title" required placeholder="Contoh: Makalah Sejarah Bab 5"></div>
        <div class="form-group full"><label for="task-class">Pilih Kelas</label><select id="task-class" required></select></div>
        <div class="form-group"><label for="task-date">Tanggal Tenggat</label><input id="task-date" type="date" required></div>
        <div class="form-group"><label for="task-time">Waktu Tenggat</label><input id="task-time" type="time" value="23:59"></div>
        <div class="form-group full"><label for="task-desc">Deskripsi (Opsional)</label><textarea id="task-desc" placeholder="Detail, instruksi, atau tautan..."></textarea></div>
        <div class="modal-actions">
            <button type="button" class="btn" id="cancel-create">Batal</button>
            <button type="submit" class="btn btn-primary">Simpan Tugas</button>
        </div>
      </form>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, getDocs, addDoc, updateDoc, arrayUnion, arrayRemove, serverTimestamp, Timestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyCGr2zchpiAiTn-bMFk-eLNE-1OgGzaSdA", authDomain: "acadmte.firebaseapp.com", projectId: "acadmte", storageBucket: "acadmte.appspot.com", messagingSenderId: "547286858993", appId: "1:547286858993:web:b83de49e7eb1cc35a67d50", measurementId: "G-ZEFYD7F650" };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentUser = null; 
    let classes = []; 
    let classMap = {}; 
    let allTasks = [];
    let allUsersCache = {}; 

    const listContainer = document.getElementById('list-container');
    const emptyEl = document.getElementById('empty');
    const iconColors = ['#f3e8ff', '#dbeafe', '#dcfce7', '#fef3c7', '#fee2e2', '#e0e7ff'];
    
    document.addEventListener('DOMContentLoaded', () => {
        paintTaskSkeletons(5);
    });

    onAuthStateChanged(auth, async (user) => {
      if (!user) { window.location.replace('auth.html'); return; }
      currentUser = user;
      hydrateAvatar();
      await loadData();
      attachEvents();
    });
    
    function showContent() {
        document.querySelector('.skeleton-wrapper').style.display = 'none';
        document.getElementById('actual-content').style.display = 'block';
    }

    async function loadData() {
        await hydrateClasses();
        await hydrateTasks();
        renderFilteredTasks();
        showContent();
    }

    function hydrateAvatar() {
      const avatar = document.getElementById('header-avatar-img');
      const name = localStorage.getItem('userDisplayName') || (currentUser?.displayName ?? 'A');
      const photo = localStorage.getItem('userPhotoURL') || currentUser?.photoURL;
      if (avatar) avatar.src = photo || `https://placehold.co/80x80/E5E7EB/6B7280?text=${(name||'A').charAt(0)}`;
    }

    async function hydrateClasses() {
      const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
      const ids = userDoc.exists() ? (userDoc.data().joinedClasses || []) : [];
      if (!ids.length) return;
      
      const snaps = await Promise.all(ids.map(id => getDoc(doc(db, 'classes', id))));
      classes = snaps.filter(s => s.exists()).map(s => ({ id: s.id, ...s.data() }));
      classMap = Object.fromEntries(classes.map(c => [c.id, c]));
      
      populateClassFilters();
      const select = document.getElementById('task-class');
      select.innerHTML = classes.map(c => `<option value="${c.id}">${escapeHTML(c.namaMataKuliah || 'Tanpa Nama')}</option>`).join('');
      
      await cacheAllMembers();
    }

    function populateClassFilters() {
      const optionsContainer = document.querySelector('.custom-select-options');
      const selectedText = document.getElementById('selected-class-name');
      const hiddenInput = document.getElementById('class-filter-value');
      
      optionsContainer.innerHTML = '';
      
      const createOption = (text, value) => {
          const option = document.createElement('div');
          option.className = 'custom-select-option';
          option.dataset.value = value;
          option.textContent = text;
          return option;
      };

      const allOption = createOption('Semua Kelas', 'all');
      allOption.classList.add('selected');
      optionsContainer.appendChild(allOption);
      classes.forEach(c => {
          optionsContainer.appendChild(createOption(escapeHTML(c.namaMataKuliah || 'Tanpa Nama'), c.id));
      });

      selectedText.textContent = 'Semua Kelas';
      hiddenInput.value = 'all';
    }
    
    async function cacheAllMembers() {
        const allMemberIds = new Set();
        classes.forEach(c => { (c.members || []).forEach(memberId => allMemberIds.add(memberId)); });
        const userDocsToFetch = [];
        allMemberIds.forEach(id => { if (!allUsersCache[id]) userDocsToFetch.push(getDoc(doc(db, 'users', id))); });
        const userSnaps = await Promise.all(userDocsToFetch);
        userSnaps.forEach(snap => { if (snap.exists()) allUsersCache[snap.id] = snap.data(); });
    }

    async function hydrateTasks() {
      allTasks = [];
      for (const c of classes) {
        const snap = await getDocs(collection(db, 'classes', c.id, 'tasks'));
        snap.forEach(d => allTasks.push({ id: d.id, classId: c.id, ...d.data() }));
      }
    }

    function renderFilteredTasks() {
      const classFilter = document.getElementById('class-filter-value').value;
      const searchQuery = (document.getElementById('global-search')?.value || '').toLowerCase();
      const activeTab = document.querySelector('.tab-btn.active')?.dataset.tab || 'active';

      let filtered = allTasks.filter(task => {
        const matchesClass = (classFilter === 'all' || task.classId === classFilter);
        const matchesSearch = (task.title || '').toLowerCase().includes(searchQuery) ||
                              (classMap[task.classId]?.namaMataKuliah || '').toLowerCase().includes(searchQuery) ||
                              (task.description || '').toLowerCase().includes(searchQuery);
        return matchesClass && matchesSearch;
      });
      
      const isDone = (task) => task.completedBy?.includes(currentUser.uid);
      const shownTasks = filtered.filter(task => activeTab === 'completed' ? isDone(task) : !isDone(task));
      
      shownTasks.sort((a, b) => (a.dueDate?.seconds || 0) - (b.dueDate?.seconds || 0));

      renderTaskList(shownTasks);
      updateProgressSummary(allTasks);

      emptyEl.style.display = shownTasks.length === 0 ? 'block' : 'none';
    }

    function renderTaskList(tasksToRender) {
      listContainer.innerHTML = '';
      if (tasksToRender.length === 0) return;
      const list = document.createElement('div');
      list.className = 'task-list';
      tasksToRender.forEach(task => list.appendChild(buildTaskCardV2(task)));
      listContainer.appendChild(list);
    }
    
    function buildTaskCardV2(task) {
        const isDone = task.completedBy?.includes(currentUser.uid);
        const { text, className } = formatTimeRemaining(task.dueDate);
        const classInfo = classMap[task.classId] || {};
        const card = document.createElement('div');
        card.className = `task-card-v2 ${isDone ? 'is-done' : ''}`;
        card.dataset.taskId = task.id;
        card.dataset.classId = task.classId;
        const color = iconColors[Math.abs(hashCode(classInfo.namaMataKuliah || '')) % iconColors.length];
        const currentClass = classes.find(c => c.id === task.classId);
        const memberCount = currentClass?.members?.length || 0;
        const completedCount = task.completedBy?.length || 0;
        const VISIBLE_AVATARS_ROW = 3;
        const hasDetails = task.description || memberCount > 0;

        let completersIndicatorHTML = '';
        if (completedCount > 0) {
            const avatarsHTML = (task.completedBy || [])
                .slice(0, VISIBLE_AVATARS_ROW)
                .map(uid => {
                    const user = allUsersCache[uid];
                    if (!user) return '';
                    const photo = user.photoURL || `https://placehold.co/40x40/E5E7EB/6B7280?text=${(user.name || 'A').charAt(0)}`;
                    return `<img src="${photo}" title="${escapeHTML(user.name || 'Pengguna')} telah menyelesaikan" alt="Avatar ${escapeHTML(user.name || 'Pengguna')}" class="avatar">`;
                }).join('');

            let moreAvatarsHTML = '';
            if (completedCount > VISIBLE_AVATARS_ROW) {
                moreAvatarsHTML = `<div class="more-avatars">+${completedCount - VISIBLE_AVATARS_ROW}</div>`;
            }
            const avatarStackHTML = `<div class="task-avatar-stack">${avatarsHTML}${moreAvatarsHTML}</div>`;

            completersIndicatorHTML = `
                <div class="completers-indicator">
                    <div class="completers-checkmark" title="${completedCount} orang telah menyelesaikan">
                        <i class="ri-check-line"></i>
                    </div>
                    ${avatarStackHTML}
                </div>`;
        }


        let descriptionContent = '';
        if (task.description) {
            descriptionContent += `<div class="task-desc-text">${escapeHTML(task.description).replace(/\n/g, '<br>')}</div>`;
        }
        if (memberCount > 0) {
            const completersTextHTML = `<div class="completers-info"><strong>${completedCount} dari ${memberCount}</strong> anggota telah menyelesaikan</div>`;
            const separatorClass = task.description ? 'with-separator' : '';
            descriptionContent += `<div class="task-completers ${separatorClass}">${completersTextHTML}</div>`;
        }

        const detailButtonHTML = hasDetails ? `<button class="detail-btn"><i class="ri-arrow-down-s-line"></i></button>` : '';

        card.innerHTML = `
            <div class="task-main-row">
                <div class="custom-checkbox" role="checkbox" aria-checked="${isDone}" title="Tandai selesai">
                    ${isDone ? '<i class="ri-check-line"></i>' : ''}
                </div>

                <div class="task-center-content">
                    <div class="task-icon-bg-v2" style="background-color: ${color};">
                        <span>${classInfo.classIcon || 'ðŸ“š'}</span>
                    </div>
                    <div class="task-content-v2">
                        <h4>${escapeHTML(task.title || 'Tanpa Judul')}</h4>
                        <div class="task-meta-v2">
                            <span class="meta-item">${escapeHTML(classInfo.namaMataKuliah || 'Kelas')}</span>
                            <div class="time-chip-v2 ${className}"><i class="ri-time-line"></i><span>${text}</span></div>
                        </div>
                    </div>
                </div>

                <div class="task-actions-wrapper">
                    ${detailButtonHTML}
                    <div class="task-completers-wrapper">
                        ${completersIndicatorHTML}
                    </div>
                </div>
            </div>
            ${hasDetails ? `<div class="task-description-v2"><div class="task-description-content-v2">${descriptionContent}</div></div>` : ''}`;

        card.addEventListener('click', (e) => {
            const check = e.target.closest('.custom-checkbox');
            const detailBtn = e.target.closest('.detail-btn');
            if (check) { toggleTaskCompletion(task.id, task.classId); }
            else if (detailBtn) { card.classList.toggle('expanded'); }
        });
        return card;
    }
    
    function paintTaskSkeletons(count) {
        const container = document.getElementById('skeleton-task-list');
        if (!container) return;
        let html = '';
        for (let i = 0; i < count; i++) {
            html += `
            <div class="task-card-v2" style="background: var(--surface);">
                <div class="task-main-row">
                    <div class="custom-checkbox sk" style="border-color: transparent;"></div>
                    <div class="task-center-content">
                        <div class="task-icon-bg-v2 sk"></div>
                        <div class="task-content-v2" style="flex-grow: 1;">
                            <div class="sk" style="height: 16px; width: 70%; border-radius: 6px;"></div>
                            <div class="sk" style="height: 12px; width: 40%; border-radius: 6px; margin-top: 8px;"></div>
                        </div>
                    </div>
                    <div class="task-actions-wrapper">
                         <div class="detail-btn sk" style="border-radius: 50%;"></div>
                    </div>
                </div>
            </div>`;
        }
        container.innerHTML = html;
    }

    async function toggleTaskCompletion(taskId, classId) {
        const task = allTasks.find(t => t.id === taskId);
        if (!task) return;
        const cardElement = document.querySelector(`[data-task-id="${taskId}"]`);
        cardElement.style.pointerEvents = 'none';
        const wasDone = task.completedBy?.includes(currentUser.uid);
        const taskRef = doc(db, 'classes', classId, 'tasks', taskId);
        try {
            if (wasDone) {
                await updateDoc(taskRef, { completedBy: arrayRemove(currentUser.uid) });
                task.completedBy = task.completedBy.filter(uid => uid !== currentUser.uid);
            } else {
                await updateDoc(taskRef, { completedBy: arrayUnion(currentUser.uid) });
                if (!task.completedBy) task.completedBy = [];
                task.completedBy.push(currentUser.uid);
            }
            renderFilteredTasks();
        } catch (error) {
            console.error("Gagal memperbarui tugas:", error);
            cardElement.style.pointerEvents = 'auto';
        }
    }

    function updateProgressSummary(tasks) {
        const progressSection = document.getElementById('progress-section');
        if (!progressSection) return;
        
        const total = tasks.length;
        const completed = tasks.filter(t => t.completedBy?.includes(currentUser.uid)).length;
        const active = total - completed;
        const overdue = tasks.filter(t => !t.completedBy?.includes(currentUser.uid) && safeGetDate(t.dueDate) < new Date()).length;
        const progress = total > 0 ? (completed / total) * 100 : 0;
        
        progressSection.innerHTML = `
            <div class="progress-card progress-main">
              <h3>Progres Keseluruhan</h3>
              <p><span><span id="completed-count-v3">${completed}</span>/<span id="total-count-v3">${total}</span></span> Selesai</p>
              <div class="progress-bar-v3">
                <div id="progress-bar-inner-v3" class="progress-bar-inner-v3" style="width: ${progress}%"></div>
              </div>
            </div>
            <div class="progress-card">
              <div class="icon-wrapper" style="--icon-bg: #e0f2fe; --icon-color: #3B82F6;">
                <i class="ri-time-line"></i>
              </div>
              <div>
                <span id="active-count-v3" class="value">${active}</span>
                <span class="label">Aktif</span>
              </div>
            </div>
            <div class="progress-card">
              <div class="icon-wrapper" style="--icon-bg: #fee2e2; --icon-color: #EF4444;">
                <i class="ri-error-warning-line"></i>
              </div>
              <div>
                <span id="overdue-count-v3" class="value">${overdue}</span>
                <span class="label">Terlewat</span>
              </div>
            </div>`;
    }

    async function createTask(e) {
      e.preventDefault();
      const form = e.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Menyimpan...';

      const title = document.getElementById('task-title').value.trim();
      const classId = document.getElementById('task-class').value;
      const date = document.getElementById('task-date').value;
      const time = document.getElementById('task-time').value || '23:59';
      const desc = document.getElementById('task-desc').value.trim();
      if(!title || !classId || !date) return;
      const dueTimestamp = new Date(`${date}T${time}`);

      try {
        await addDoc(collection(db, 'classes', classId, 'tasks'), { title, classId, description: desc, dueDate: Timestamp.fromDate(dueTimestamp), completedBy: [], createdAt: serverTimestamp() });
        toggleModal('create-task-modal', false);
        form.reset();
        document.querySelector('.skeleton-wrapper').style.display = 'block';
        document.getElementById('actual-content').style.display = 'none';
        await loadData();
      } catch (err) {
        console.error("Gagal membuat tugas:", err);
        alert('Gagal membuat tugas. Silakan coba lagi.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Simpan Tugas';
      }
    }

    function attachEvents(){
      document.getElementById('logout-button-desktop')?.addEventListener('click', () => signOut(auth));
      document.getElementById('open-create-modal').addEventListener('click', () => toggleModal('create-task-modal', true));
      document.getElementById('cancel-create').addEventListener('click', () => toggleModal('create-task-modal', false));
      document.getElementById('create-task-modal').addEventListener('click', (e) => { if(e.target === e.currentTarget) toggleModal('create-task-modal', false); });
      document.getElementById('create-task-form').addEventListener('submit', createTask);
      
      document.getElementById('global-search').addEventListener('input', renderFilteredTasks);
      document.querySelector('.tabs').addEventListener('click', (e) => {
        if (!e.target.classList.contains('tab-btn')) return;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        renderFilteredTasks();
      });

      const selectWrapper = document.querySelector('.custom-select-wrapper');
      const trigger = selectWrapper.querySelector('.custom-select-trigger');
      const options = selectWrapper.querySelector('.custom-select-options');
      const hiddenInput = selectWrapper.querySelector('#class-filter-value');
      const selectedText = selectWrapper.querySelector('#selected-class-name');

      trigger.addEventListener('click', () => { selectWrapper.classList.toggle('open'); });

      options.addEventListener('click', (e) => {
        const option = e.target.closest('.custom-select-option');
        if (!option) return;
        const value = option.dataset.value;
        hiddenInput.value = value;
        selectedText.textContent = option.textContent;
        options.querySelectorAll('.custom-select-option').forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
        selectWrapper.classList.remove('open');
        renderFilteredTasks();
      });

      document.addEventListener('click', (e) => {
        if (!selectWrapper.contains(e.target)) {
          selectWrapper.classList.remove('open');
        }
      });
    }

    function toggleModal(id, show) {
        const el = document.getElementById(id);
        if (show) el.classList.add('show'); else el.classList.remove('show');
    }

    function formatTimeRemaining(d) {
        const due = safeGetDate(d);
        if (!due) return { text: 'Tanpa Tenggat', className: 'safe' };
        const now = new Date();
        const diffHours = (due - now) / (1000 * 60 * 60);
        if (diffHours < 0) return { text: 'Lewat', className: 'overdue' };
        if (diffHours < 24) return { text: 'Hari Ini', className: 'urgent' };
        if (diffHours < 48) return { text: 'Besok', className: 'urgent' };
        const diffDays = Math.ceil(diffHours / 24);
        if (diffDays <= 7) return { text: `${diffDays}h Lagi`, className: 'soon' };
        return { text: due.toLocaleString('id-ID', { day: 'numeric', month: 'short' }), className: 'safe' };
    }
    
    function safeGetDate(ts) { return (ts && typeof ts.toDate === 'function') ? ts.toDate() : null; }
    function hashCode(str) { let h=0;for(let i=0;i<str.length;i++)h=((h<<5)-h)+str.charCodeAt(i),h|=0;return h; }
    function escapeHTML(s) { return (s||'').replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }
  </script>
</body>
</html>


